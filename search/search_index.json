{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Welcome to MkDocs","text":"<p>For full documentation visit mkdocs.org.</p>"},{"location":"#commands","title":"Commands","text":"<ul> <li><code>mkdocs new [dir-name]</code> - Create a new project.</li> <li><code>mkdocs serve</code> - Start the live-reloading docs server.</li> <li><code>mkdocs build</code> - Build the documentation site.</li> <li><code>mkdocs -h</code> - Print help message and exit.</li> </ul>"},{"location":"#project-layout","title":"Project layout","text":"<pre><code>mkdocs.yml    # The configuration file.\ndocs/\n    index.md  # The documentation homepage.\n    ...       # Other markdown pages, images and other files.\n</code></pre>"},{"location":"Applications/cloudflare/","title":"Cloudflare","text":""},{"location":"Applications/cloudflare/#wie-richte-ich-einen-proxy-dns-fur-dns-over-httpsdoh-ein","title":"Wie richte ich einen proxy DNS f\u00fcr DNS Over HTTPS(DOH) ein?","text":""},{"location":"Applications/cloudflare/#revision-2","title":"Revision 2","text":"<p>Sources:</p> <ul> <li>https://developers.cloudflare.com/1.1.1.1/dns-over-https/cloudflared-proxy#dnscrypt-proxy</li> <li>https://github.com/DNSCrypt/dnscrypt-proxy</li> <li>https://github.com/pi-hole/pi-hole/wiki/DNSCrypt-2.0</li> </ul>"},{"location":"Applications/cloudflare/#revision-1","title":"Revision 1","text":"<p>Zun\u00e4chst die vorkompilierte binary runterladen (hier f\u00fcr arm64):</p> <pre><code>wget https://github.com/cloudflare/cloudflared/releases/download/2020.11.11/cloudflared-linux-arm64 -O /usr/local/bin/cloudflared\n</code></pre> <p>Dann die Berechtigungen setzen:</p> <pre><code>useradd -r -M -s /usr/sbin/nologin -c \"Cloudflared user\" cloudflared\nchown cloudflared:cloudflared /usr/local/bin/cloudflared\nchmod +x /usr/local/bin/cloudflared\n</code></pre> <p>und den Service erzeugen(/etc/systemd/system/cloudflared_dns.service):</p> <pre><code>[Unit]\nDescription=cloudflared DNS over HTTPS proxy\nAfter=syslog.target network-online.target\n\n[Service]\nType=simple\nUser=cloudflared\nExecStart=/usr/local/bin/cloudflared proxy-dns --port 5053 --upstream https://1.1.1.1/dns-query --upstream https://1.0.0.1/dns-query\nRestart=on-failure\nRestartSec=10\nKillMode=process\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>Check mit:</p> <p>https://1.1.1.1/help</p> <p>Sources:</p> <ul> <li>https://docs.pi-hole.net/guides/dns-over-https/</li> <li>https://www.cyberciti.biz/faq/configure-ubuntu-pi-hole-for-cloudflare-dns-over-https/</li> <li>https://developers.cloudflare.com/argo-tunnel/downloads/</li> <li>https://github.com/cloudflare/cloudflared/issues/115</li> <li>https://github.com/golang/go/wiki/Ubuntu</li> <li>http://manpages.ubuntu.com/manpages/trusty/pt/man5/host.5.html</li> </ul>"},{"location":"Applications/cloudflare/#original","title":"Original","text":"<p>Erst einmal laden wir das aktuelle Interface von Cloudflare runter: dann m\u00fcssen wir es kompilieren auf dem normalen Ger\u00e4t.</p> <p>Daf\u00fcr zun\u00e4chst Golang installieren, wir brauchen daf\u00fcr ein separates ppa (machen wir nat\u00fcrlich auf unserem eigenem Rechner):</p> <pre><code>snap install --classic go\n</code></pre> <p>Danach kompilieren: Get the source</p> <pre><code>go get github.com/cloudflare/cloudflared/cmd/cloudflared\n</code></pre> <p>Build for arm64</p> <pre><code>GOOS=linux GOARCH=arm64 go build -x github.com/cloudflare/cloudflared/cmd/cloudflared\n</code></pre>"},{"location":"Applications/collabora/","title":"Collabora","text":""},{"location":"Applications/collabora/#using-the-built-in-server","title":"Using the built-in Server","text":"<p>adding |.+\\/richdocumentscode\\/proxy seems to be important to nginx.</p> <p>Sources:</p> <ul> <li>https://github.com/nextcloud/documentation/blob/1f7dd0bb814045d37ff38fbb1217274695c79cae/admin_manual/installation/nginx.rst</li> <li>https://www.collaboraoffice.com/online/connecting-collabora-online-built-in-code-server-with-nginx/</li> </ul>"},{"location":"Applications/collabora/#using-the-external-server","title":"Using the external Server","text":"<p>Multiple things seem to be relevant here:</p> <ul> <li>overwritehost and overwriteprotocoll need to be set in nextcloud otherwise collabora will not recognize the domain if it is coming from behind the reverse proxy(localhost)</li> <li>collabora needs to use ssl.terminate and ssl.enable=false to work behind reverseproxy otherwise traffic will not match</li> <li>if collabora is used behind nginx with nginx-proxy, it should forward all traffic to collabora in http not https</li> <li>generally it seems to work best if collabora is connected right to the nginx-proxy without another in front of it.</li> <li>Theoretically it might be possible to use it without another domain and just use the nextcloud domain and referencing it in the same nginx site as the nextcloud but that does not seem advisable.</li> </ul> <p>Sources:</p> <ul> <li>https://help.nextcloud.com/t/failed-to-connect-to-collabora-online/53118/13</li> <li>https://github.com/nextcloud/docker/pull/630</li> <li>https://github.com/ReinerNippes/nextcloud_on_docker</li> <li>https://help.nextcloud.com/t/collabora-nextcloud-dockerized-http-requests-blocked-by-iptables-behind-reverse-proxy/90278/6</li> <li>https://icewind.nl/entry/collabora-online/</li> <li>https://help.nextcloud.com/t/nginx-collabora-behind-nginx-reverse-proxy/77889</li> </ul>"},{"location":"Applications/collabora/#kubernetes","title":"Kubernetes","text":"<p>document locked</p> <p>Sources:</p> <ul> <li>https://forum.seafile.com/t/collabora-document-locked-read-only/14305</li> <li>https://manual.seafile.com/deploy/libreoffice_online/#config-seafile</li> </ul>"},{"location":"Applications/fail2ban/","title":"Fail2Ban","text":""},{"location":"Applications/fail2ban/#revision-1-with-docker","title":"Revision 1 with docker","text":"<p>Switched to docker, building on crazymax fail2ban docker. But instead of sendmail I use mailx and instead of ssmtp I use msmtp. In alpine mailx is called as \"mail\" that is why</p> <pre><code>mta = mail\n</code></pre> <p>in the jail.config</p> <p>Also please note that to refer to an action you always need to use</p> <pre><code>%(action_)%s[Parameter....]\n</code></pre> <p>Where [Parameters] is optional.</p> <p>Unbans are done via</p> <pre><code>docker container exec fail2ban fail2ban-client set MYJAIL unbanip IP\n</code></pre> <p>check which bans are currently in place with:</p> <pre><code>iptables -n -L\n</code></pre>"},{"location":"Applications/fail2ban/#original","title":"Original","text":"<p>Originally I used fail2ban on server directly. But this also has the downside of fail2ban being outdated.</p> <p>Sources:</p> <ul> <li>https://www.digitalocean.com/community/tutorials/how-fail2ban-works-to-protect-services-on-a-linux-server</li> <li>https://visei.com/2020/05/incremental-banning-with-fail2ban/</li> <li>https://github.com/crazy-max/docker-fail2ban</li> <li>https://stackoverflow.com/questions/60694033/mailx-not-found-in-alpine</li> <li>https://decatec.de/home-server/nextcloud-auf-ubuntu-server-18-04-lts-mit-nginx-mariadb-php-lets-encrypt-redis-und-fail2ban/#E-Mail-Versand_durch_Fail2ban</li> <li>https://github.com/fail2ban/fail2ban</li> <li>https://unix.stackexchange.com/questions/286119/delete-all-fail2ban-bans-in-ubuntu-linux</li> </ul>"},{"location":"Applications/firewall/","title":"Firewall","text":""},{"location":"Applications/firewall/#ufw","title":"UFW","text":""},{"location":"Applications/firewall/#basics","title":"Basics","text":"<p>using ufw</p> <pre><code>sudo ufw enable sudo ufw allow 8080\n</code></pre> <p>some apps offer presets for ufw like</p> <pre><code>sudo ufw app list\nsudo ufw allow calibre\n</code></pre> <p>Sources:</p> <ul> <li>https://wiki.ubuntu.com/BasicSecurity</li> <li>https://help.ubuntu.com/lts/serverguide/firewall.html</li> </ul>"},{"location":"Applications/firewall/#wie-aktiviere-ich-logging-fur-ufw","title":"Wie aktiviere ich logging f\u00fcr ufw?","text":"<p>einfach</p> <pre><code>ufw logging on\n</code></pre> <p>Logs sind dann in /var/log/ufw</p> <p>Sources:</p> <ul> <li>https://serverfault.com/questions/516838/where-are-the-logs-for-ufw-located-on-ubuntu-server</li> </ul>"},{"location":"Applications/firewall/#network-security-with-firewalld","title":"Network Security with Firewalld","text":"<pre><code>firewall-cmd --list-all --zone=public\nfirewall-cmd --get-zone-of-interface=eth0\nfirewall-cmd --permanent --zone=external --change-interface=eth0\nfirewall-cmd --remove-interface=eth0 --zone=external\nfirewall-cmd --list-services --zone=external\nfirewall-cmd --reload\n</code></pre> <p>Sources:</p> <ul> <li>https://www.redhat.com/sysadmin/firewalld-zones-and-rules</li> <li>https://unix.stackexchange.com/questions/559980/cant-remove-interface-from-zone-with-networkmanager-enabled-firewalld-cent</li> </ul>"},{"location":"Applications/github/","title":"Github","text":"<p>Use self hosted runners by specifying the runs-on like</p> <pre><code>jobs:\nbuild:\nruns-on: [self-hosted, arm64]\n</code></pre> <p>start runner on host with docker</p> <pre><code>docker create --name armrunner \\\n-e RUNNER_NAME=armrunner \\\n-e GITHUB_ACCESS_TOKEN=XXXXXXXXXXXXXXXXXXXX \\\n-e RUNNER_REPOSITORY_URL=https://github.com/XXXXXXX \\\n-v /var/run/docker.sock:/var/run/docker.sock \\\nghcr.io/stkr22/github-self-hosted-runner:main\n</code></pre> <p>Sources:</p> <ul> <li>https://docs.github.com/en/actions/using-workflows/workflow-syntax-for-github-actions#choosing-self-hosted-runners</li> </ul>"},{"location":"Applications/gitlab/","title":"Gitlab","text":""},{"location":"Applications/gitlab/#security","title":"Security","text":"<p>Go to Admin Area &gt; Settings &gt; General and expand Sign-up restrictions. Clear the Sign-up enabled checkbox, then select Save changes.</p> <p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/46195852/how-to-run-gitlab-in-docker-container-with-nginx-proxy-over-ssl-with-letsencrypt</li> <li>https://docs.gitlab.com/omnibus/settings/nginx.html</li> <li>https://docs.gitlab.com/omnibus/docker/</li> <li>https://docs.gitlab.com/omnibus/settings/configuration.html#setting-initial-root-password-on-installation-</li> <li>https://docs.gitlab.com/ce/user/admin_area/settings/sign_up_restrictions.html#enable-or-disable-soft-email-confirmation</li> <li>https://docs.gitlab.com/omnibus/settings/backups.html</li> </ul>"},{"location":"Applications/gitlab/#using-external-storage","title":"Using external storage","text":"<p>As written by gitlab, it is sufficient to just use appConfig.object_store.connection for specifying the secret. It will then be used by all services for storing data.</p> <p>Sources:</p> <ul> <li>https://docs.gitlab.com/charts/charts/globals.html#consolidated-object-storage</li> <li>https://docs.gitlab.com/charts/advanced/external-object-storage/index.html#docker-registry-images</li> </ul>"},{"location":"Applications/gitlab/#kaniko","title":"Kaniko","text":""},{"location":"Applications/gitlab/#basics","title":"Basics","text":"<p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/3162385/how-to-split-a-string-in-shell-and-get-the-last-field</li> <li>https://docs.gitlab.com/ee/ci/variables/predefined_variables.html</li> <li>https://docs.gitlab.com/ee/ci/docker/using_kaniko.html</li> <li>https://docs.gitlab.com/ee/ci/jobs/job_control.html</li> <li>https://stackoverflow.com/questions/63483953/gitlab-ci-only-trigger-only-merge-request-specific-branch</li> </ul>"},{"location":"Applications/gitlab/#gitlab-ci-variables-for-kaniko","title":"Gitlab CI variables for kaniko","text":"<p>Create Environment scope Create new personal access toeken Projekt settings &gt; CI/CD &gt; Variables</p> <p>Sources:</p> <ul> <li>https://gitlab.com/guided-explorations/containers/kaniko-docker-build/-/tree/master</li> <li>https://docs.gitlab.com/ee/api/project_level_variables.html</li> <li>https://docs.gitlab.com/ee/ci/environments/index.html</li> <li>https://stackoverflow.com/questions/37468084/what-is-the-special-gitlab-ci-token-user</li> <li>https://www.youtube.com/watch?v=d96ybcELpFs</li> </ul>"},{"location":"Applications/gitlab/#kubernetes","title":"Kubernetes","text":""},{"location":"Applications/gitlab/#using-external-cert-manager","title":"Using external cert manager","text":"<p>Sources:</p> <ul> <li>https://gitlab.com/gitlab-org/charts/gitlab/blob/master/doc/installation/tls.md</li> </ul>"},{"location":"Applications/gitlab/#using-external-nginx","title":"Using external nginx","text":"<p>Sources:</p> <ul> <li>https://docs.gitlab.com/charts/advanced/external-nginx/#helm-deployment</li> </ul>"},{"location":"Applications/gitlab/#backups","title":"Backups","text":"<p>It is important to backup the rails secrets once an instance is set up:</p> <pre><code>kubectl get secrets gitlab-rails-secret -o jsonpath=\"{.data['secrets\\.yml']}\" | base64 --decode &gt; {{ PATH_TO_SECRET }}\n</code></pre> <p>Manual</p> <pre><code>kubectl exec --namespace gitlab -it {{ GITLAB_RUNNER_POD_NAME }} -- backup-utility\n</code></pre> <p>or using conr based helm chart settings.</p> <p>Secrets also need to be updated</p> <p>Sources:</p> <ul> <li>https://docs.gitlab.com/ee/raketasks/backup_restore.html#back-up-gitlab</li> <li>https://gitlab.com/gitlab-org/charts/gitlab/blob/master/doc/backup-restore/backup.md#cron-based-backup</li> <li>https://docs.gitlab.com/charts/backup-restore/#object-storage</li> <li>https://gitlab.com/gitlab-org/charts/gitlab/blob/master/doc/backup-restore/backup.md#backup-the-secrets</li> </ul>"},{"location":"Applications/gitlab/#restore","title":"Restore","text":"<p>It is vital to always restore to the same gitlab version! Double check the corresponding application version to the chart version you are using.</p> <p>First, restore gitlab rails secrets and note that you cannot use relative path like ~/Downloads:</p> <pre><code>kubectl delete secret gitlab-rails-secret\nkubectl create secret generic gitlab-rails-secret --from-file=secrets.yml={{ SECRET_PATH }}\n</code></pre> <p>Next restart pods:</p> <pre><code>kubectl delete pods -lapp=sidekiq,release=gitlab\nkubectl delete pods -lapp=webservice,release=gitlab\nkubectl delete pods -lapp=task-runner,release=gitlab\n</code></pre> <p>Next upload the backup tar to the gitlab-backups bucket, e.g.:</p> <pre><code>mc alias set gitlab-minio-restore https://{{ MINIO_URL }}:443 \\\n$(kubectl get secret --namespace gitlab gitlab-minio-secret -o jsonpath=\"{.data.accesskey}\" | base64 --decode) \\\n$(kubectl get secret --namespace gitlab gitlab-minio-secret -o jsonpath=\"{.data.secretkey}\" | base64 --decode)\n</code></pre> <pre><code>mc cp {{ SOURCE_PATH }} {{ MINIO_BACKUP_PATH }}\n</code></pre> <p>Next execute the backup:</p> <pre><code>kubectl exec $(kubectl get pods -lrelease=gitlab,app=task-runner -o jsonpath=\"{.items[0].metadata.name}\") -it -- backup-utility --restore -t 1634936403_2021_10_22_14.3.3\n</code></pre> <p>restart pods:</p> <pre><code>kubectl delete pods -lapp=sidekiq,release=gitlab\nkubectl delete pods -lapp=webservice,release=gitlab\n</code></pre> <p>Sources:</p> <ul> <li>https://docs.gitlab.com/charts/backup-restore/restore.html</li> </ul>"},{"location":"Applications/grafana/","title":"Grafana","text":""},{"location":"Applications/grafana/#build-dashboards","title":"Build dashboards","text":"<p>Simply look for a dashboard and click on the plus icon to the left in the main menu. Then you chose import and enter the dashbaords id.</p> <p>Sources:</p> <ul> <li>https://grafana.com/grafana/dashboards/9614</li> <li>https://grafana.com/grafana/dashboards/9632</li> </ul>"},{"location":"Applications/grafana/#overriding-time-interval-in-graphics","title":"Overriding time interval in graphics","text":"<p>Sources:</p> <ul> <li>https://grafana.com/docs/grafana/latest/dashboards/time-range-controls/#panel-time-overrides-and-timeshift</li> </ul>"},{"location":"Applications/grafana/#format-datetime-in-tables","title":"Format datetime in tables","text":"<p>Sources:</p> <ul> <li>https://grafana.com/docs/grafana/latest/administration/configuration/#date_formats</li> <li>https://github.com/grafana/grafana/issues/24917#issuecomment-685690047</li> </ul>"},{"location":"Applications/grafana/#timezone-in-datepicker","title":"Timezone in datepicker","text":"<p>Grafana changes the choosen timerange in datapicker based on the local timezone of the browser. e.g. If I choose last month and my local browser time is CEST then Grafana will move the generated timestamp by 2 hours (if it is using UTC). So</p> <pre><code>BETWEEN '2022-03-01T00:00:00Z' AND '2022-03-31T23:59:59.999Z'\n</code></pre> <p>becomes</p> <pre><code>BETWEEN '2022-02-28T23:00:00Z' AND '2022-03-31T21:59:59.999Z'\n</code></pre> <p>Sources:</p> <ul> <li>https://github.com/grafana/grafana/issues/13769</li> </ul>"},{"location":"Applications/grafana/#provision-dashboards-with-folder-structure","title":"Provision dashboards with folder structure","text":"<p>Sources:</p> <ul> <li>https://grafana.com/docs/grafana/latest/administration/provisioning/</li> <li>https://github.com/ezienecker/grafana-sidecar-folder-sample</li> <li>https://github.com/prometheus-community/helm-charts/issues/336#issuecomment-745569146</li> </ul>"},{"location":"Applications/grafana/#provisiong-dashboards-with-secrets","title":"Provisiong dashboards with secrets","text":"<p>Sources:</p> <ul> <li>https://grafana.com/docs/grafana/latest/administration/provisioning/</li> </ul>"},{"location":"Applications/keycloak/","title":"Keycloak","text":""},{"location":"Applications/keycloak/#where-do-i-find-the-most-important-settings","title":"Where do I find the most important settings?","text":"<p>Go to Realm setting &gt; General &gt; OpenID Endpoint Configuration</p>"},{"location":"Applications/keycloak/#authentication-with-oauth2","title":"Authentication with oauth2","text":"<p>One of the problems I had when setting this up is the missing email for the user. When using keycloak with OAuth2 there needs to be an email adress set ine each user profile otherwise you might get:</p> <p>Error creating session during OAuth2 callback: id_token did not contain an email and profileURL is not defined</p> <p>Sources:</p> <ul> <li>https://www.talkingquickly.co.uk/webapp-authentication-keycloak-OAuth2-proxy-nginx-ingress-kubernetes</li> </ul>"},{"location":"Applications/minio/","title":"Minio","text":""},{"location":"Applications/minio/#secrets","title":"Secrets","text":"<p>ExternalCertSecret is for passing user-minted TLS certificates to MinIO pods.</p> <p>Similarly, credsSecret defines the MinIO root access key and secret key. IIRC, CONSOLE_ACCESS_KEY and CONSOLE_SECRET_KEY are the credentials Console uses to access the MinIO cluster. I believe the idea here is that you shouldn't really be using the root credentials for normal operations. So they are distinct users.</p> <p>Sources:</p> <ul> <li>https://github.com/minio/operator/issues/593</li> <li>https://github.com/minio/operator/blob/master/docs/crd.adoc#k8s-api-github-com-minio-operator-pkg-apis-minio-min-io-v2-tenantspec</li> </ul>"},{"location":"Applications/minio/#bucket-policies","title":"Bucket policies","text":"<p>Create user first</p> <p>Create Policy like</p> <pre><code>{\n\"Version\": \"2012-10-17\",\n\"Statement\": [\n{\n\"Action\": [\n\"s3:*\"\n],\n\"Effect\": \"Allow\",\n\"Resource\": [\n\"arn:aws:s3:::{{ BUCKET_NAME }}/*\"\n],\n\"Sid\": \"\"\n}\n]\n}\n</code></pre> <p>Sources:</p> <ul> <li>https://docs.min.io/docs/minio-multi-user-quickstart-guide.html</li> <li>https://docs.aws.amazon.com/AmazonS3/latest/userguide/example-bucket-policies.html</li> </ul>"},{"location":"Applications/minio/#uploadsync-to-minio-with-rclone","title":"Upload/Sync to Minio with RClone","text":"<p>First the config needs to be set up</p> <pre><code>rclone config\n</code></pre> <p>Next we set env_auth to true instead of saving credentials in our config file. Now we need to set env variables:</p> <pre><code>export AWS_ACCESS_KEY={{ SUPERSAVEACCKEY }}\nexport AWS_SECRET_KEY={{ SUPERSAVESECRETKEY }}\n</code></pre> <p>Sources:</p> <ul> <li>https://rclone.org/s3/#authentication</li> <li>https://rclone.org/s3/#minio</li> <li>https://rclone.org/install/#install-with-docker</li> </ul>"},{"location":"Applications/minio/#sync-data-with-minio-client","title":"Sync data with Minio client","text":"<pre><code>mc mirror --remove --preserve $MINIO_ENV/&lt;bucket&gt; $BACKUPS_DIR/$BACKUP_NAME\n</code></pre>"},{"location":"Applications/minio/#kubernetes","title":"Kubernetes","text":""},{"location":"Applications/minio/#how-to-ingress-to-console","title":"How To ingress to console","text":"<p>It seems one needs both console and browser to work efficiently. In addition the minio redirect url MINIO_BROWSER_REDIRECT_URL needs to be set</p> <p>Sources:</p> <ul> <li>https://docs.min.io/docs/minio-quickstart-guide.html</li> </ul>"},{"location":"Applications/minio/#connect-to-minio","title":"Connect to Minio","text":"<pre><code>wget https://dl.min.io/client/mc/release/linux-amd64/mc\nchmod +x mc\n</code></pre> <p>Set alias (use port 443 for HTTPS!!!!)</p> <pre><code>./mc alias set {{ MY_MINIO }} https://{{ MINIO_URL }}:443 {{ USER }} {{ SECRET_KEY }}\n./mc ls minio\n./mc cp {{ SOURCE_FILE_PATH }} {{ SINK_FILE_PATH }}\n</code></pre> <p>Sources:</p> <ul> <li>https://docs.min.io/docs/minio-client-quickstart-guide.html</li> <li>https://docs.min.io/docs/minio-quickstart-guide.html</li> </ul>"},{"location":"Applications/minio/#upload-to-minio-with-curl","title":"Upload to minio with curl","text":"<pre><code># Usage: ./minio-upload my-bucket my-file.zip\nbucket=$1\nfile=$2\nhost=${S3_HOST:-$minio_host}\ns3_key=${S3_KEY:-$access_key}\ns3_secret=${S3_SECRET:-$secret}\nresource=\"/${bucket}/${file}\"\ncontent_type=\"application/octet-stream\"\ndate='date -R'\n_signature=\"PUT\\n\\n${content_type}\\n${date}\\n${resource}\"\nsignature='echo -en ${_signature} | openssl sha1 -hmac ${s3_secret} -binary | base64'\ncurl -X PUT -T \"${file}\" \\\n-H \"Host: ${host}\" \\\n-H \"Date: ${date}\" \\\n-H \"Content-Type: ${content_type}\" \\\n-H \"Authorization: AWS ${s3_key}:${signature}\" \\\nhttps://${host}${resource}\n</code></pre> <p>Sources:</p> <ul> <li>https://gist.github.com/PhilipSchmid/1fd2688ace9f51ecaca2788a91fec133</li> <li>https://gist.github.com/rubyman/cef14548ac4fb71762ff7ba8ab8f15d8</li> <li>https://docs.min.io/docs/minio-client-quickstart-guide.htmlconsole-address</li> </ul>"},{"location":"Applications/msmtp/","title":"MSMTP","text":""},{"location":"Applications/msmtp/#set-up","title":"Set up","text":"<p>I use MSMTP because SSMTP is outdated and lo longer maintained. First install msmtp and mailutils</p> <pre><code>aptitude install msmtp msmtp-mta mailutils\n</code></pre> <p>After that we need to configure the relevant config file:</p> <pre><code>cat &gt;&gt; /etc/msmtprc &lt;&lt;EOL\n    defaults\n    auth           on\n    tls            on\n    tls_trust_file /etc/ssl/certs/ca-certificates.crt\n    syslog         on\n    # service\n    account        service\n    host           {{ SMTP_HOST }}\n    port           587\n    from           {{ EMAIL_ADRESS }}\n    user           {{ USERNAME }}\n    password       {{ PASSWORD }}\n    # Set a default account\n    account default : service\n    aliases        /etc/aliases\n    EOL\n</code></pre> <p>When checking docs on this keep in mind that ports might differ if you take into consideration that mail is a \"relay\" mail program. The permissions should be</p> <pre><code>chmod 600 /etc/msmtprc\n</code></pre> <p>If you plan on sending mails to users later</p> <pre><code>echo -e \"Subject: Do you love alpine?\\nYes, I do!\\n\" | msmtp root\n</code></pre> <p>Than do not forget to set up aliases in /etc/aliases properly!</p> <p>To activate msmtp we need to change mail in ubuntu like:</p> <pre><code>vi /etc/mail.rc\n</code></pre> <pre><code>set sendmail=\"/usr/bin/msmtp -t\"\n</code></pre> <p>Sources:</p> <ul> <li>https://decatec.de/linux/linux-einfach-e-mails-versenden-mit-msmtp/</li> <li>https://wiki.archlinux.org/index.php/SSMTP</li> <li>https://wiki.alpinelinux.org/wiki/Relay_email_to_gmail_(msmtp,_mailx,_sendmail</li> </ul>"},{"location":"Applications/music/","title":"Music","text":""},{"location":"Applications/music/#airsonic-advanced","title":"Airsonic Advanced","text":"<p>Sources:</p> <ul> <li>https://github.com/airsonic-advanced/airsonic-advanced</li> <li>https://github.com/truecharts/apps/tree/master/charts/stable/airsonic-advanced</li> </ul>"},{"location":"Applications/music/#navidrome","title":"Navidrome","text":"<p>Chose navidrome because I do not need all of Airsonics features and it is not mobile optimized. Navidrome can be used on mobile and desktop equally.</p> <p>Sources:</p> <ul> <li>https://github.com/navidrome/navidrome</li> <li>https://www.navidrome.org/docs/installation/docker/</li> </ul>"},{"location":"Applications/nextcloud/","title":"Nextcloud","text":"<p>Installing Nextcloud using Docker.</p> <p>Send a file to shared folder</p> <p>In Docker Compose together with Redis and Mariadb.</p> <p>Update container:</p> <pre><code>docker -f nextcloud-docker-compose.yml down\ndocker-compose pull &amp;&amp; docker-compose -f nextcloud-docker-compose.yml up\n</code></pre> <p>Nginx is initialized with its own network:</p> <pre><code>docker network create nginx-proxy\n</code></pre> <p>After initialization once</p> <pre><code>bash init.sh\n</code></pre> <p>Create users with:</p> <pre><code>docker container exec -it --user www-data nextcloud_app php occ user:add --display-name=\"{{ YOUR_NAME }}\" {{ USERNAME }}\n</code></pre> <p>Move from previous Nextcloud docker:</p> <pre><code>mv /path/to/files /var/lib/docker/volumes/docker-nextcloud_nextcloud-data/_data/{{ USERNAME }}/files/\ndocker container exec {{ CONTAINER_NAME }} chown -R www-data:www-data /var/nextcloud_data\ndocker container exec --user www-data {{ CONTAINER_NAME }} php occ files:scan --all\n</code></pre> <p>create calendars and adressbooks:</p> <pre><code>bash init.sh\n</code></pre> <p>Sources:</p> <ul> <li>https://hub.docker.com/_/redis/?tab=description&amp;page=1&amp;ordering=last_updated</li> <li>https://github.com/nextcloud/docker</li> <li>https://github.com/nextcloud/docker/tree/master/.examples</li> <li>https://www.addictivetips.com/ubuntu-linux-tips/integrate-libreoffice-with-nextcloud/</li> <li>https://docs.nextcloud.com/server/latest/admin_manual/configuration_server/reverse_proxy_configuration.html</li> <li>https://dennisnotes.com/note/20180831-nextcloud-docker-nginx-reverse-proxy/</li> <li>https://github.com/nginx-proxy/docker-letsencrypt-nginx-proxy-companion/blob/master/docs/Docker-Compose.md</li> <li>https://help.nextcloud.com/t/nextcloud-in-docker-not-accepting-trusted-domains/64208/8</li> <li>https://docs.nextcloud.com/server/20/admin_manual/configuration_server/config_sample_php_parameters.html</li> <li>https://docs.nextcloud.com/server/20/admin_manual/configuration_server/occ_command.html#config-commands</li> <li>https://help.nextcloud.com/t/create-new-calendars-using-lightning-without-the-gui/61055/5</li> <li>https://help.nextcloud.com/t/birthdays-have-disappeared-from-the-nextcloud-calendar/29779</li> </ul>"},{"location":"Applications/nginx/","title":"NGINX","text":""},{"location":"Applications/nginx/#how-do-i-open-a-datastream","title":"How do I open a datastream?","text":"<p>Simply with the nginx.conf</p> <pre><code>stream {\n  upstream {{ HOST_INTERNAL_NAME }} {\n  server {{ TARGET_HOST }};\n  }\n  server {\n    listen 8768;\n    proxy_pass {{ HOST_INTERNAL_NAME }};\n    include /etc/nginx/manual_ip;\n    allow {{ IP_ADDRESS_RANGE }}/20;\n    deny all;\n    }\n}\n</code></pre> <p>The server in the sites-available then looks like this:</p> <pre><code>server {\n listen 8768;\n proxy_pass {{ HOST_INTERNAL_NAME }};\n}\n</code></pre>"},{"location":"Applications/node-red/","title":"NodeRed","text":""},{"location":"Applications/node-red/#set-up","title":"Set up","text":"<p>Sources:</p> <ul> <li>https://nodered.org/docs/getting-started/docker</li> </ul>"},{"location":"Applications/node-red/#integration-with-mqtt","title":"Integration with MQTT","text":"<p>Sources:</p> <ul> <li>https://cookbook.nodered.org/mqtt/</li> </ul>"},{"location":"Applications/node-red/#integrations","title":"Integrations","text":"<p>Sources:</p> <ul> <li>https://diyfuturism.com/index.php/2017/11/26/big-list-of-home-automation-nodes-for-node-red/</li> <li>https://aarongodfrey.dev/home%20automation/nodered-for-automations-in-home-assistant/</li> </ul>"},{"location":"Applications/node-red/#using-variables-in-nodered","title":"Using Variables in NodeRed","text":"<p>Sources:</p> <ul> <li>https://stevesnoderedguide.com/node-red-variables</li> </ul>"},{"location":"Applications/node-red/#node-red-projects","title":"Node Red Projects","text":"<p>Clone an existing project. Use PAT with \"repo\" permission for password. Use HTTPS repository.</p> <p>Sources:</p> <ul> <li>https://discourse.nodered.org/t/node-red-project-and-github/1344/2</li> <li>https://nodered.org/docs/user-guide/projects/</li> </ul>"},{"location":"Applications/node-red/#subscribing-to-multiple-mqtt-topics","title":"Subscribing to multiple mqtt topics","text":"<p>Sources:</p> <ul> <li>https://discourse.nodered.org/t/efficiently-subscribe-to-multiple-mqtt-topics-using-one-mqtt-node/30527/4</li> </ul>"},{"location":"Applications/node-red/#mqtt","title":"MQTT","text":"<p>Sources:</p> <ul> <li>https://stevesnoderedguide.com/configuring-the-mqtt-publish-node</li> </ul>"},{"location":"Applications/node-red/#trigger","title":"Trigger","text":"<p>When set via msg.delay it is always calculated in miliseconds.</p> <p>Sources:</p> <ul> <li>https://discourse.nodered.org/t/delay-node-variable-delay-not-seeming-to-work/14603/5</li> </ul>"},{"location":"Applications/pigallery/","title":"PiGallery 2","text":""},{"location":"Applications/pigallery/#pigallery-settings-and-env-variables","title":"Pigallery Settings and ENV variables","text":"<p>Sources:</p> <ul> <li>https://github.com/bpatrik/pigallery2/blob/master/MANPAGE.md</li> </ul>"},{"location":"Applications/pigallery/#set-up","title":"Set Up","text":"<p>Sources:</p> <ul> <li>https://github.com/bpatrik/pigallery2/blob/master/docker/docker-compose/with-mysql/docker-compose.yml</li> <li>https://github.com/bpatrik/pigallery2</li> <li>https://github.com/bpatrik/pigallery2/blob/master/docker/README.md</li> </ul>"},{"location":"Applications/pigallery/#how-to-make-face-tags-from-digikam-available-to-pigallery2","title":"How to make face tags from digikam available to Pigallery2","text":"<p>XMP / Face Tags via Adobe standard</p> <p>Sources:</p> <ul> <li>https://photo.stackexchange.com/questions/102829/picture-metadata-and-face-tags-what-software-to-write-and-read-them/112986#112986</li> </ul>"},{"location":"Applications/pihole/","title":"PiHole","text":""},{"location":"Applications/pihole/#how-do-i-install-pihole","title":"How do I install PiHole ?","text":""},{"location":"Applications/pihole/#revision-1","title":"Revision 1","text":"<p>Use docker pihole/pihole:latest</p> <p>Exact:</p> <p>{{ URL }} {{ URL }}</p> <p>Wildcard</p> <p>{{ URL_WITH_WILDCARD }}</p> <p>Also important after the update do not forget the Gravity:</p> <pre><code>docker container exec pihole_app pihole updateGravity\n</code></pre> <p>There may be problems with the LG App Store and EULA Agreements / signing if ngfts.lge.com is blocked. Then allow once and unblock again (after restarting the device).</p> <p>For Windows Spy Protection in Admin Panel under settings &gt; blocklists add:</p> <ul> <li>https://raw.githubusercontent.com/crazy-max/WindowsSpyBlocker/master/data/hosts/spy.txt</li> </ul>"},{"location":"Applications/pihole/#original","title":"Original","text":"<p>Load script</p> <pre><code>curl -sSL https://install.pi-hole.net | bash\n</code></pre> <p>During the installation write down the IPs for the Fritzbox. LightPd must not be installed if later or earlier Nginx is used as a server is used. Specify no in the corresponding question! Do not accept the firewall rules! The script writes these directly into the IpTables and this will confuse ufw later. In the Fritzbox store the then displayed IPs and uncheck the checkbox always assign the same IP to this device under Home &gt; Network Important regarding firewall ufw, port 53 must be open!</p> <pre><code>ufw allow 53\n</code></pre> <p>to change DNS note point 4.3 at Kuketz Blog Link. Important, if this is selected, then the DNS must be adjusted separately for IPv6 and IPv4 at the Fritzbox as described in 4.3!</p> <p>Sources:</p> <ul> <li>https://www.kuketz-blog.de/pi-hole-schwarzes-loch-fuer-werbung-raspberry-pi-teil1/</li> <li>https://docs.pi-hole.net/guides/nginx-configuration/</li> <li>https://www.raspberrypi.org/forums/viewtopic.php?t=246376</li> <li>https://www.kuketz-blog.de/nacharbeiten-pi-hole-in-kombination-mit-pivpn/</li> <li>https://discourse.pi-hole.net/t/resolved-recent-ubuntu-update-causes-strange-dns-issue/20449</li> </ul> <p>Issues:</p> <ul> <li>https://stackoverflow.com/questions/32100834/how-to-set-php-ini-settings-in-nginx-config-for-just-one-host</li> <li>https://coderwall.com/p/gt2g3q/setting-multiple-php_value-in-nginx-config</li> <li>https://stackoverflow.com/questions/3829403/how-to-increase-the-execution-timeout-in-php/3829437#3829437</li> </ul> <p>-------------------- Ende original</p> <p>Sources:</p> <ul> <li>https://github.com/crazy-max/WindowsSpyBlocker/</li> <li>https://www.reddit.com/r/pihole/comments/6qmpv6/blacklists_for_lg_webos_tvs/</li> </ul>"},{"location":"Applications/pihole/#blocklist-for-pihole","title":"Blocklist for pihole","text":"<p>Use:</p> <ul> <li>https://raw.githubusercontent.com/crazy-max/WindowsSpyBlocker/master/data/hosts/spy.txt</li> <li>https://raw.githubusercontent.com/FadeMind/hosts.extras/master/add.Spam/hosts</li> <li>https://raw.githubusercontent.com/PolishFiltersTeam/KADhosts/master/KADhosts.txt</li> <li>https://v.firebog.net/hosts/Easyprivacy.txt</li> <li>https://v.firebog.net/hosts/AdguardDNS.txt</li> <li>https://adaway.org/hosts.txt</li> <li>https://www.github.developerdan.com/hosts/lists/ads-and-tracking-extended.txt</li> </ul> <p>Sources:</p> <ul> <li>https://www.reddit.com/r/pihole/comments/hpfajt/best_blocklists/</li> <li>https://firebog.net/</li> </ul>"},{"location":"Applications/piwigo/","title":"Piwigo","text":""},{"location":"Applications/piwigo/#install","title":"Install","text":"<pre><code> version: '3'\nservices:\npiwigo:\nimage: ghcr.io/linuxserver/piwigo\ncontainer_name: piwigo\nenvironment:\n- PUID=1000\n- PGID=1000\n- TZ=Europe/Berlin\nrestart: unless-stopped\ndepends_on: - db\nnetwork_mode: service:db\ndb:\nimage: mariadb:latest\nrestart: unless-stopped\nports:\n- 80:80\n- 3307:3306\nenvironment:\n- MYSQL_ROOT_PASSWORD={{ MYSQL_ROOT_PASSWORD }}\n- MYSQL_USER=piwigouser\n- MYSQL_PASSWORD={{ MYSQL_PASSWORD }}\n- MYSQL_DATABASE=piwigo\n</code></pre> <p>Sources:</p> <ul> <li>https://lycheeorg.github.io/demo/</li> <li>https://lycheeorg.github.io/</li> <li>https://www.linuxlinks.com/Lychee/</li> <li>https://github.com/Piwigo/Piwigo</li> <li>https://hub.docker.com/r/linuxserver/piwigo/</li> </ul>"},{"location":"Applications/prometheus/","title":"Prometheus","text":""},{"location":"Applications/prometheus/#install-grafana-and-prometheus","title":"install Grafana and Prometheus","text":"<p>Sources:</p> <ul> <li>https://kubernetes.github.io/ingress-nginx/user-guide/monitoring/</li> <li>https://www.fosstechnix.com/install-prometheus-and-grafana-on-kubernetes-using-helm/</li> <li>https://github.com/prometheus-operator/kube-prometheus</li> </ul>"},{"location":"Applications/prometheus/#prometheus-metrics","title":"Prometheus Metrics","text":"<p>Sources:</p> <ul> <li>https://cert-manager.io/docs/usage/prometheus-metrics/</li> </ul>"},{"location":"Applications/prometheus/#kubernetes","title":"Kubernetes","text":""},{"location":"Applications/prometheus/#prometheus-watching-all-namespaces","title":"Prometheus watching all namespaces","text":"<p>After consulting stakeoverflow as well as the github repo it turned out that the documentation is completely outdated. If one wants prometheus to watch all namespaces for services and pods etc. then we need to alter the null value treatment:</p> <pre><code>prometheusSpec:\nruleSelectorNilUsesHelmValues: false\nserviceMonitorSelectorNilUsesHelmValues: false\npodMonitorSelectorNilUsesHelmValues: false\nprobeSelectorNilUsesHelmValues: false\n</code></pre> <p>Sources:</p> <ul> <li>https://github.com/helm/charts/issues/20581#issuecomment-610370687</li> <li>https://github.com/prometheus-operator/prometheus-operator/blob/master/Documentation/api.md#namespaceselector</li> <li>https://stackoverflow.com/a/65648944</li> <li>https://github.com/prometheus-operator/prometheus-operator/issues/2890#issuecomment-583006452</li> <li>https://stackoverflow.com/a/60710751</li> </ul>"},{"location":"Applications/radicale/","title":"Radicale","text":""},{"location":"Applications/radicale/#config","title":"Config","text":"<p>Radicale is a simple CalDav/CardDav Server. I had several issues with authentication and nginx-ingress. Most of my issues originated from the fact that nginx strips most headers from the answer it sends back to the service/pod. In my case the authentication headers were often lost and radicale treated me as an unauthenticated user.</p> <p>In the end I could solve this by adding the following annotation:</p> <pre><code>nginx.ingress.kubernetes.io/configuration-snippet: |-\nproxy_set_header X-Remote-User $remote_user;\n</code></pre> <p>Config radicale to expect X-Remote-User by:</p> <pre><code>type = http_x_remote_user\n</code></pre> <p>I decided against nginx and I am now using radicale to make use to the delay option. The secret is mounted inside the container and nginx is using:</p> <pre><code>nginx.ingress.kubernetes.io/configuration-snippet: |-\nproxy_pass_header Authorization;\n</code></pre> <p>In general I think the best solution is to use keycloak in combination with unicorn for auth but that is more of a longterm solution.</p> <p>Sources:</p> <ul> <li>https://github.com/h3ndrk/radicale-k8s</li> <li>https://radicale.org/3.0.html#tutorials/reverse-proxy</li> </ul>"},{"location":"Applications/radicale/#backup","title":"Backup","text":""},{"location":"Applications/radicale/#rclone","title":"Rclone","text":"<p>Install rclone</p> <pre><code>curl https://rclone.org/install.sh | sudo bash\n</code></pre> <p>Configuration should look like this:</p> <pre><code>[minio-backup]\ntype = s3\nprovider = Minio\naccess_key_id = key\nsecret_access_key = key2\nendpoint = https://{{ MINIO_URL }}\nacl = private\n</code></pre> <p>set new crontab</p> <pre><code>rclone move minio-backup:backups/ /mnt/backup/radicale\n</code></pre> <p>Sources:</p> <ul> <li>https://rclone.org/seafile/</li> </ul>"},{"location":"Applications/rclone/","title":"RClone","text":""},{"location":"Applications/rclone/#how-to-use-rclone","title":"How to use Rclone?","text":"<p>Use rclone to sync a folder to a remote</p> <pre><code>rclone sync --transfers 4 --checkers 10 --delete-after --progress --stats 10s {{ SOURCE_FOLDER }} {{ REMOTE }}:{{ TARGET_FOLDER }}\n</code></pre> <p>Mount a remote folder</p> <pre><code>rclone mount --allow-other {{ SOURCE_FOLDER }} {{ REMOTE }}:{{ TARGET_FOLDER }}\n</code></pre> <p>You can also use rclone to encrypt on the fly. Sync is then directed towards to crypt remote which points to the real remote.</p> <p>Source:</p> <ul> <li>https://rclone.org/crypt/</li> <li>https://www.andyibanez.com/posts/rclone-basics-encryption/</li> </ul>"},{"location":"Applications/seafile/","title":"Seafile","text":""},{"location":"Applications/seafile/#sso","title":"SSO","text":"<p>Also see prepared .json file in seafile folder and config maps with seafile.</p> <p>Sources:</p> <ul> <li>https://de.seafile.com/sso-seafile-keycloak/</li> <li>https://manual.seafile.com/deploy/oauth/</li> </ul>"},{"location":"Applications/seafile/#2fa","title":"2FA","text":"<p>Activate in System Settings. Use QTQR for scanning</p> <pre><code>aptitude install qtqr\n</code></pre>"},{"location":"Applications/seafile/#backup","title":"Backup","text":""},{"location":"Applications/seafile/#rclone","title":"RClone","text":"<p>Configure rclone</p> <pre><code>rclone config\n</code></pre> <pre><code>[seafile-backup]\ntype = seafile\nurl = https://{{ SEAFILE_URL }}\nuser = {{ USER_NAME }}\npass =\n2fa = true\nauth_token = XXXXXXXXXXXXXXXXXXXXXXX\n</code></pre> <p>With crontab</p> <pre><code>@midnight rclone sync seafile-backup: /mnt/backup/seafile/\n</code></pre> <p>Sources:</p> <ul> <li>https://rclone.org/seafile/</li> </ul>"},{"location":"Applications/seafile/#seafile-cli","title":"Seafile CLI","text":"<p>The Seafile CLI seems to be a good way to go. However, I'll have to see if I can get it built yet. Currently the CLI only supports SSO from 8.0.4.</p> <p>However, it is not available for ARM64. Alternatively the client package may work.</p> <pre><code>sudo add-apt-repository ppa:seafile/seafile-client\naptitude install seafile-cli\n</code></pre> <p>Sources:</p> <ul> <li>https://help.seafile.com/syncing_client/linux-cli/#authenticate-with-tokens</li> <li>https://code.launchpad.net/~seafile/+archive/ubuntu/seafile-client</li> <li>https://github.com/haiwen/seafile-client</li> <li>https://manual.seafile.com/build_seafile/linux/</li> <li>https://debian.pkgs.org/sid/debian-main-arm64/seafile-gui_8.0.4-1_arm64.deb.html</li> </ul>"},{"location":"Applications/seafile/#kubernetes","title":"Kubernetes","text":"<p>Sources:</p> <ul> <li>https://github.com/300481/seafile-server</li> <li>https://forum.seafile.com/t/deploying-modern-seafile-to-kubernetes/13986</li> </ul>"},{"location":"Applications/signal/","title":"Signal","text":""},{"location":"Applications/signal/#build-signal","title":"Build Signal","text":"<p>As always it is never just \"Working\". I had to built the java libraries form scratch to work on my raspberry pi.</p> <p>Steps are:</p> <ul> <li>Install GraalVM  install build-essential libz-dev zlib1g-dev</li> <li>Fetching &amp; compiling (sources) libsignal-client-java-0.2.3 &amp; zkgroup-0.7.2</li> <li>Fetching (sources) signal-cli-0.8.1</li> <li>Copying the results of libsignal-client-java-0.2.3 &amp; zkgroup-0.7.2 compilations (libsignal_jni.so &amp; libzkgroup.so) into signal-cli-0.8.1/lib/src/main/resources</li> <li>Finally compiling signal-cli-0.8.1 with gradle assembleNativeImage</li> </ul> <p>Sources:</p> <ul> <li>https://github.com/exquo/signal-libs-build/releases</li> <li>https://github.com/AsamK/signal-cli/issues/615</li> <li>https://github.com/bbernhard/signal-cli-rest-api/tree/master/ext/libraries/libsignal-client</li> <li>https://github.com/bbernhard/signal-cli-rest-api/tree/master/ext/libraries/zkgroup</li> <li>https://github.com/bbernhard/signal-cli-rest-api</li> <li>https://github.com/bbernhard/signal-cli-rest-api/blob/master/Dockerfile</li> <li>https://wiki.fhem.de/wiki/Signalbot#Probleme_bei_normaler_Installation</li> <li>https://www.graalvm.org/reference-manual/native-image/#prerequisites</li> </ul>"},{"location":"Applications/signal/#set-up-signal","title":"Set up Signal","text":"<p>First install the library:</p> <pre><code>export VERSION=LATEST_VERSION\nwget https://github.com/AsamK/signal-cli/releases/download/v\"${VERSION}\"/signal-cli-\"${VERSION}\".tar.gz\nsudo tar xf signal-cli-\"${VERSION}\".tar.gz -C /opt\nsudo ln -sf /opt/signal-cli-\"${VERSION}\"/bin/signal-cli /usr/local/bin/\n</code></pre> <p>Then we need to register a number. Note that I always needed a capture so probably get one upfront on (https://signalcaptchas.org/registration/generate.html):</p> <pre><code>signal-cli -u {{ YOUR_NUMBER }} register --captcha {{ YOUR_CAPTCHA }}\n</code></pre> <p>F12 click console and look for a warning that includes a very long address(Prevented navigation to \u201csignalcaptcha://).</p> <p>Keys can be found here: ls -lia .local/share/signal-cli/</p> <p>Sources:</p> <ul> <li>https://github.com/AsamK/signal-cli/wiki/Quickstart</li> <li>https://github.com/AsamK/signal-cli/wiki/Linking-other-devices-%28Provisioning%29</li> <li>https://github.com/AsamK/signal-cli/wiki/DBus-service</li> <li>https://signald.org/articles/captcha/</li> <li>https://fabiobarbero.eu/posts/signalbot/</li> </ul>"},{"location":"Applications/vscode/","title":"VsCode","text":""},{"location":"Applications/vscode/#how-do-i-run-bash-code-directly-from-vscode","title":"How do I run bash code directly from VsCode?","text":"<p>Ctrl+Shift+P and choose run selected text. Click on the small symbol on the right and set a keybinding.</p> <p>Sources:</p> <ul> <li>https://code.visualstudio.com/docs/editor/integrated-terminal#_run-selected-text</li> </ul>"},{"location":"Applications/vscode/#python","title":"Python","text":""},{"location":"Applications/vscode/#vscode-plugins","title":"Vscode Plugins","text":"<ul> <li>Python</li> <li>Bracket Colorizer 2</li> <li>Community Material Theme (ocean dark) equinusocio.vsc-material-theme</li> <li>Docker</li> <li>indent Rainbow</li> <li>Material Icon Theme pkief.material-icon-theme</li> <li>Python Docstring Generator njpwerner.autodocstring</li> <li>Python Indent kevinrose.vsc-python-indent</li> </ul>"},{"location":"Applications/vscode/#how-do-i-debug-stuff","title":"How do I debug stuff?","text":"<p>set breakpoints and click on run&amp;debug on the left hand side.</p>"},{"location":"Applications/vscode/#how-do-i-select-the-jupyter-kernel","title":"How do I select the jupyter kernel?","text":"<p>Ctrl+P -&gt; Select jupyter kernel to start with</p>"},{"location":"Applications/vscode/#run-code-interactively-with-shorts","title":"Run code interactively with shorts","text":"<p>you can simply run code interactively by entering</p> <pre><code># %%\n</code></pre> <p>This will give you the option to run or debug cells below. No need for IPython notebooks. Note that you can switch the env down below. Also note that you then need to restart the current session strg.</p>"},{"location":"Applications/vscode/#run-test-automatically","title":"Run test automatically","text":"<p>Use the little flask menu on the left. But before you can use that you need to enable it in the python extension settings. Search for \"test\" and set the Python &gt; Testing Enabled.  </p> <p>Also set the Python &gt; Testing Pytest Path so that is knows where to find tests</p>"},{"location":"Applications/vscode/#linting","title":"Linting","text":"<p>Add your virtual env to the Python &gt; Linting Ignore Patterns. And activate linting. I use Flake8, Pylint and Bandit for security.</p>"},{"location":"Applications/wireguard/","title":"Wireguard","text":""},{"location":"Applications/wireguard/#setting-up-wireguard","title":"Setting up Wireguard","text":"<p>Under Ubuntu 20.04 you can install the WireGuard directly. With 18.04 we always have to add the ppa first.</p> <p>before setting the config, we can replace the privatekey and the \"ens3\" (it should be venet0, but the first command shows something else) with query interface by default</p> <p>Sources:</p> <ul> <li>https://linuxize.com/post/how-to-set-up-wireguard-vpn-on-ubuntu-18-04/</li> <li>https://www.linode.com/docs/networking/vpn/set-up-wireguard-vpn-on-ubuntu/</li> <li>https://www.thomas-krenn.com/de/wiki/ubuntu_Desktop_als_WireGuard_VPN_Client_konfigurieren</li> <li>https://www.linode.com/docs/networking/vpn/set-up-wireguard-vpn-on-ubuntu/</li> </ul>"},{"location":"Applications/zigbee2mqtt/","title":"Zigbee2MQTT","text":""},{"location":"Applications/zigbee2mqtt/#tuya-switches-consumed-energy-reset","title":"Tuya switches consumed energy reset","text":"<p>To reset \"Sum of consumed energy\", use the Dev console and execute: Endpoint: 1 Cluster: 0x00 Command: 0 Payload: (don't change this)</p> <p>Sources:</p> <ul> <li>https://www.zigbee2mqtt.io/devices/TS011F_plug_3.html#reset-energy</li> </ul>"},{"location":"Applications/zigbee2mqtt/#issues-with-conbeeii","title":"Issues with conbeeii","text":"<pre><code>docker run -it --rm --entrypoint \"/firmware-update.sh\" --privileged --cap-add=ALL -v /dev:/dev -v /lib/modules:/lib/modules -v /sys:/sys deconzcommunity/deconz\n</code></pre> <p>Sources:</p> <ul> <li>https://github.com/Koenkk/zigbee2mqtt/issues/9554</li> <li>https://www.zigbee2mqtt.io/guide/adapters/#recommended</li> <li>https://github.com/deconz-community/deconz-docker#updating-conbeeraspbee-firmware</li> <li>https://github.com/dresden-elektronik/deconz-rest-plugin/wiki/Update-deCONZ-manually</li> <li>https://github.com/deconz-community/deconz-docker#readme</li> </ul>"},{"location":"Docker/configuration/","title":"Docker Configuration","text":""},{"location":"Docker/configuration/#general","title":"General","text":""},{"location":"Docker/configuration/#what-is-the-difference-between-runexec-or-cmdcmd-shell","title":"What is the difference between RUN/EXEC or CMD/CMD-SHELL?","text":"<p>RUN always works even if an image does not have a shell installed or not default shell defined. EXEC on the other hand is dependent on a default shell but has the advantage of offering all features of that shell like PATH or variables etc. CMD/CMD-SHELL are similar. One particular problem for executions outside healthechecks can be that SHELL commands have PID 1, which gets problematic if the container should be shut down (but I did not get why).</p> <p>Sources:</p> <ul> <li>https://devops.stackexchange.com/questions/11501/healthcheck-cmd-vs-cmd-shell</li> </ul>"},{"location":"Docker/configuration/#what-are-capabilities","title":"What are Capabilities?","text":"<p>Capabilities give system priviliges to containers like controlling iptables with NET_ADMIN. By default containers are unpriviliged and do not have any rights on the host system.</p> <p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/58377469/difference-between-cap-add-net-admin-and-add-capabilities-in-yml</li> </ul>"},{"location":"Docker/configuration/#difference-between-build-context-and-dockerfile-location","title":"Difference between build context and Dockerfile location","text":"<pre><code>docker build -f {{ PATH_TO_DOCKERFILE }} . --tag=\"{{ YOUR_REGISTRY_URL }}{{ YOUR_REPOSITORY_PATH }}:{{ YOUR_TAG }}\"\n</code></pre>"},{"location":"Docker/configuration/#how-to-clean-up","title":"How to clean up?","text":"<p>Several options are available. First you want to clean up all container related resources like dangling images(no tags), dangling volumes(not associated with a container), dangling networks etc. Then do:</p> <pre><code>docker system prune --volumes\n</code></pre> <p>Besides that you also might loose a lot of space due to tagged images that you do not use respectively are currently not used by any container. That can be done by:</p> <pre><code>docker image prune --all\n</code></pre> <p>Sources:</p> <ul> <li>https://yallalabs.com/devops/how-to-remove-all-unused-dangling-docker-images/</li> </ul>"},{"location":"Docker/configuration/#using-github-ghcrio-registry","title":"Using Github ghcr.io registry","text":"<p>First generate a personal access token(PAT) via settings &gt; developer settings &gt; personal access token or use this link</p> <pre><code>docker login ghcr.io -u USERNAME\n</code></pre> <p>Sources:</p> <ul> <li>https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry</li> <li>https://docs.github.com/en/packages/managing-github-packages-using-github-actions-workflows/publishing-and-installing-a-package-with-github-actions#upgrading-a-workflow-that-accesses-ghcrio</li> <li>https://docs.github.com/en/repositories/releasing-projects-on-github/managing-releases-in-a-repository#creating-a-release</li> <li>https://docs.github.com/en/packages/working-with-a-github-packages-registry/working-with-the-container-registry#authenticating-to-the-container-registry</li> <li>https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token</li> </ul>"},{"location":"Docker/configuration/#how-do-i-connect-my-container-to-the-host-network","title":"How do I connect my container to the host network?","text":"<p>By default docker isolates the container from the host and thus the container cannot access any services on the host. On e way to solve this is by binding the service to the docker adress ( which I did not figured out yet). Alternatively one can set the network to host</p> <pre><code>docker run --network=host alpine\n</code></pre> <p>Sources:</p> <ul> <li>https://www.baeldung.com/linux/docker-connecting-containers-to-host</li> </ul>"},{"location":"Docker/configuration/#how-to-set-up-a-systemd-service-for-docker","title":"How to set up a systemd service for docker?","text":"<p>Not that easy especially because systemd does observe the docker client and not the actual container. Type should be \"simple\", because it waits e.g. with notify for an exit, which does not come, if the container is not started detached. The small \"-\" at the beginning ensures that this part continues even with errors. The easiest for now seems to keep it simple:</p> <pre><code>[Unit]\nDescription={{ CONTAINER_DESCRIPTION }}\nAfter=docker.service\nRequires=docker.service\n\n[Service]\nType=simple\nUser=ubuntu\nGroup=docker\nRestart=always\nExecStartPre=-docker container stop {{ CONTAINER_NAME }}\nExecStartPre=-docker container rm {{ CONTAINER_NAME }}\nExecStartPre=-docker pull {{ CONTAINER_REPOSITORY }}\nExecStart=docker container run {{ CONTAINER_REPOSITORY }}\nExecStop=docker container stop -t 4 {{ CONTAINER_NAME }}\nExecRestart=docker container restart {{ CONTAINER_NAME }}\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>Sources:</p> <ul> <li>https://blog.container-solutions.com/running-docker-containers-with-systemd</li> <li>https://dev.to/suntong/autostart-docker-container-with-systemd-5aod</li> </ul>"},{"location":"Docker/configuration/#docker-compose","title":"Docker Compose","text":""},{"location":"Docker/configuration/#docker-and-docker-compose-pull-most-recent-images-how","title":"Docker and docker compose pull most recent images how?","text":"<pre><code>docker-compose pull\ndocker container pull\n</code></pre> <p>for docker dompose there is not --pull flag for</p> <pre><code>docker-compose up\n</code></pre> <p>thus the easiest is to:</p> <pre><code>docker-compose pull &amp;&amp; docker-compose up --build --detach\n</code></pre>"},{"location":"Docker/configuration/#network","title":"Network","text":""},{"location":"Docker/configuration/#network-security-with-docker","title":"Network security with docker","text":"<p>By default docker is creating iptable rules for all exposed ports that do not reside on internal network. These iptable rules are always evaluated before ufw or firewalld rules. This effectively renders the firewall useless for docker purposes and one should never expose docker ports to all interfaces like</p> <pre><code>ports:\n- 53:53\n</code></pre> <p>that are not meant to be publicly available. Instead use the loopback interface for bind like so</p> <pre><code>ports:\n- 127.0.0.1:53:53\n</code></pre> <p>Sources:</p> <ul> <li>https://degreesofzero.com/article/docker-and-firewalls.html</li> <li>https://stackoverflow.com/questions/66592057/how-to-correct-configuration-for-firewalld-and-docker-nginx</li> </ul>"},{"location":"Docker/configuration/#how-do-i-reach-another-docker-container-on-the-same-network-from-one-container","title":"How do I reach another Docker container on the same network from one container?","text":"<p>The Docker container must be in the same internal or external network as the Docker container we are in. Then it can be referenced by its \"tag\". e.g.</p> <pre><code>app:\nbuild: ./\ncontainer_name: {{ CONTAINER_NAME }}\n</code></pre> <p>would be the \"tag\" app.</p>"},{"location":"Docker/configuration/#how-to-set-up-an-internal-dns-alias","title":"How to set up an internal dns alias?","text":"<p>by referencing it as an alias of the network.</p> <pre><code>services:\n{{ CONTAINER_NAME }}:\nnetworks:\ndefault:\naliases: - {{ YOUR_ALIAS_URL }}\n</code></pre> <p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/47577490/resolve-container-name-in-extra-hosts-option-in-docker-compose</li> </ul>"},{"location":"Docker/configuration/#how-to-set-the-build-directive-correctly-if-the-build-directory-is-outside-the-compose-directory","title":"How to set the build directive correctly if the build directory is outside the compose directory?","text":"<pre><code>build:\ncontext: ../\ndockerfile: {{ PATH_TO_DOCKERCOMPOSE_FILE }}\n</code></pre>"},{"location":"Docker/configuration/#how-do-i-use-docker-secrets-in-docker-compose","title":"How do I use docker secrets in docker compose?","text":"<p>In general secrets are similar to reference a file (add \"_FILE\" to our env name) instead of value when using environmental variables:</p> <pre><code>services:\npostgres_db:\nimage: postgres\nsecrets:\n- db_user\n- db_password\nenvironment:\n- POSTGRES_USER_FILE=/run/secrets/db_user\n- POSTGRES_PASSWORD_FILE=/run/secrets/db_password\n</code></pre> <p>All secrets need to referenced in the docker compose file at the end. For non production environments we can use the secret directive and refer to files:</p> <pre><code> secrets:\npsql_user:\nfile: ./psql_user.txt\npsql_password:\nfile: ./psql_password.txt\n</code></pre> <p>For production we should correctly initialize these secrets:</p> <pre><code>printf \"{{ MY_DB_USER }}\" | docker secret create {{ SECRET_NAME }} -\n</code></pre> <p>and then will refer to external secrets:</p> <pre><code> secrets:\ndb_user:\nexternal: true\ndb_password:\nexternal: true\n</code></pre> <p>Please note: Secrets will be available in containers as literal files. Thus if an app simply \"loads\" a secret based environmental variable it will get the path back and not the actual secret. Most images now automatically switch to check the contents of the referenced file if they find \"_FILE\" at the end of the name. But it is not officially supported by Docker. Alternativel one can use an entrypoint script(see link 2).</p> <p>Secrets are a docker swarm only feature!!!</p> <p>Sources:</p> <ul> <li>https://www.rockyourcode.com/using-docker-secrets-with-docker-compose/</li> <li>https://medium.com/@adrian.gheorghe.dev/using-docker-secrets-in-your-environment-variables-7a0609659aab</li> </ul>"},{"location":"Docker/installation/","title":"Docker Installation","text":""},{"location":"Docker/installation/#store-recourcesoptional","title":"Store recources(optional)","text":"<p>All Docker related resource should reside in the /docker/ folder. Also they should be only accessible by root</p> <pre><code>chown root:root -R /docker\nchmod -R 600 /docker\n</code></pre>"},{"location":"Docker/usage/","title":"Docker Usage","text":""},{"location":"Docker/usage/#which-modes-are-supported-in-docker","title":"Which modes are supported in docker?","text":"<p>detached</p> <pre><code>docker container run -d / docker-compose up --detached\n</code></pre> <p>attached</p> <pre><code>docker container run / docker-compose up\n</code></pre> <p>interactive</p> <p>Sources:</p> <ul> <li>https://linuxbuz.com/docker-tutorial/docker-run-command-with-examples</li> </ul>"},{"location":"Docker/usage/#how-do-i-enter-commands-directly-in-a-docker","title":"How do I enter commands directly in a docker?","text":"<pre><code>docker container exec -it {{ CONTAINER_NAME }} /bin/bash\n</code></pre>"},{"location":"Docker/usage/#how-do-i-inspect-a-part-of-my-container","title":"How do I inspect a part of my container?","text":"<pre><code>docker inspect --format='{{json .State.Health}}' {{ CONTAINER_NAME }}\n</code></pre>"},{"location":"Docker/usage/#how-do-i-view-the-log-of-an-existing-container","title":"How do I view the log of an existing container?","text":"<p>Simply use the logs command:</p> <pre><code>docker-compose -f {{ PATH_TO_DOCKERCOMPOSE_FILE }} logs -f\n</code></pre> <p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/37195222/how-to-view-log-output-using-docker-compose-run</li> </ul>"},{"location":"Docker/usage/#how-to-copy-files-into-a-container","title":"How to copy files into a container?","text":"<p>simplest way to copy a folder \"data\" into container_name:</p> <pre><code>docker container cp data {{ CONTAINER_NAME }}:/\n</code></pre> <p>alternatively if just the contents of a folder should be copied:</p> <pre><code>docker container cp ./data/. {{ CONTAINER_NAME }}:/data/\n</code></pre> <p>the \".\" at the end specifies that only the contents should be copied.</p> <p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/32566624/docker-cp-all-files-from-a-folder-to-existing-container-folder</li> </ul>"},{"location":"Docker/usage/#how-to-backup-containers-safely","title":"How to backup containers safely?","text":"<p>One way is snapshots with</p> <pre><code>docker container commit\n</code></pre> <p>that will snapshot the complete state of the contaienr and is thus fairly big depending on the container. If one just wants to save the data inside the container, there are different ways.</p> <p>One way would be to either grant docker user group to a technical user or alternatively to let root do the backup. For an automatic external solution an openssh server which has access to the volumes of containers that should be backuped is better. In addition it allows to only give access to that container and the access to volumes is read only.</p> <p>It is important to note that in order to mount existing volumes from other containers the external attribute must be set! Otherwise docker compose will simply create a new volumes with the container name in front of it.</p> <pre><code>data:\nexternal:\nname: {{ VOLUME_NAME }}\n</code></pre> <p>Problem how to make the backup with borgbackup? Mount the container with sshfs Then pull the backup with borgbackup over the local mountpoint</p> <p>Sources:</p> <ul> <li>https://github.com/linuxserver/docker-openssh-server</li> <li>https://jpetazzo.github.io/2014/06/23/docker-ssh-considered-evil/</li> <li>https://docs.docker.com/compose/compose-file/compose-file-v3/#volume-configuration-reference</li> <li>https://www.digitalocean.com/community/tutorials/how-to-use-sshfs-to-mount-remote-file-systems-over-ssh</li> <li>https://borgbackup.readthedocs.io/en/stable/quickstart.html#remote-repositories</li> </ul>"},{"location":"Docker/usage/#how-do-i-make-application-available","title":"How do I make application available?","text":"<p>use nginx-proxy</p> <p>Sources:</p> <ul> <li>https://github.com/nginx-proxy/docker-letsencrypt-nginx-proxy-companion/wiki/Advanced-usage</li> </ul>"},{"location":"Kubernetes/data/","title":"Kubernetes Data","text":""},{"location":"Kubernetes/data/#how-to-store-sensitive-information","title":"How to store sensitive information?","text":""},{"location":"Kubernetes/data/#how-to-store-secrets-in-kubernetes","title":"How to store secrets in Kubernetes?","text":"<pre><code>kubectl create secret generic dev-db-secret \\\n--from-literal=username={{ USERNAME }} \\\n--from-literal=password='{{ PASSWORD }}'\n</code></pre> <p>generate random secret:</p> <pre><code>kubectl create secret generic minio-creds-secret \\\n--from-literal=accesskey=$(head -c 512 /dev/urandom | LC_CTYPE=C tr -cd 'a-zA-Z0-9' | head -c 20)\n</code></pre> <p>or from file:</p> <pre><code>kubectl create secret generic db-user-pass \\\n--from-file=username=./username.txt \\\n--from-file=password=./password.txt\n</code></pre> <p>Sources:</p> <ul> <li>https://kubernetes.io/docs/concepts/configuration/secret/</li> <li>https://kubernetes.io/docs/tasks/configmap-secret/managing-secret-using-kubectl/</li> <li>https://docs.gitlab.com/charts/installation/secrets#minio-secret</li> </ul>"},{"location":"Kubernetes/data/#how-to-access-secrets","title":"How to access secrets?","text":"<pre><code>kubectl describe secret {{ SECRET }}\nkubectl get secret {{ SECRET }} -o jsonpath='{.data}'\n</code></pre> <p>Sources:</p> <ul> <li>https://phoenixnap.com/kb/kubernetes-secrets</li> </ul>"},{"location":"Kubernetes/data/#encrypt-private-repository-secrets","title":"Encrypt private repository secrets","text":"<p>Use Docker Login first and then use the resulting dockerconfig json file as reference.</p> <pre><code>kubectl create secret generic regcred \\\n--from-file=.dockerconfigjson={{ path/to/.docker/config.json }} \\\n--type=kubernetes.io/dockerconfigjson\n</code></pre> <p>Alternatively create the secret directly</p> <pre><code>kubectl create secret docker-registry regcred --docker-server={{ your-registry-server }} --docker-username={{ your-name }} --docker-password={{ your-pword }} --docker-email={{ your-email }}\n</code></pre> <p>Sources: https://kubernetes.io/docs/tasks/configure-pod-container/pull-image-private-registry/</p>"},{"location":"Kubernetes/data/#how-to-encrypt-secrets-at-rest","title":"How to encrypt secrets at rest?","text":"<p>Sources:</p> <ul> <li>https://kubernetes.io/docs/tasks/administer-cluster/encrypt-data/</li> </ul>"},{"location":"Kubernetes/data/#how-to-create-a-basic-auth-secret","title":"How to create a basic auth secret?","text":"<pre><code>USER=$(head -c 512 /dev/urandom | LC_CTYPE=C tr -cd 'a-zA-Z0-9' | head -c 10); PASSWORD=$(head -c 512 /dev/urandom | LC_CTYPE=C tr -cd 'a-zA-Z0-9' | head -c 64); MYAUTH=\"${USER}:$(openssl passwd -stdin -apr1 &lt;&lt;&lt; ${PASSWORD})\"\nkubectl create secret generic --namespace {{ NAMESPACE  }} {{ SECRET_NAME }} \\\n--from-literal=users=$MYAUTH\n</code></pre> <pre><code>USER={{ USERNAME }}; read -s -p \"password: \" PASSWORD; MYAUTH=\"${USER}:$(openssl passwd -stdin -apr1 &lt;&lt;&lt; ${PASSWORD})\"\n</code></pre> <p>Sources:</p> <ul> <li>https://longhorn.io/docs/1.1.2/deploy/accessing-the-ui/longhorn-ingress/</li> </ul>"},{"location":"Kubernetes/data/#configmaps","title":"Configmaps","text":""},{"location":"Kubernetes/data/#use-configmaps-in-an-read-and-write-setting","title":"Use configmaps in an read and write setting","text":"<p>SOmetimes you might want to use a configmap as config file for an application. Unfortunately the application needs to be able to write to that file.</p> <p>One possible solution I found is using an init container:</p> <pre><code>initContainers:\n- name: config-creator\nimage: busybox:latest\nimagePullPolicy: IfNotPresent\nargs:\n- 'echo ''Setting Configmaps'' &amp;&amp; mkdir -p {{ PATH_TO_CONFIG }} &amp;&amp; cp {{ PATH_TO_CONFIGMAP }} {{ PATH_TO_CONFIG_FILE }}'\ncommand:\n- sh\n- -c\nvolumeMounts:\n- name: data\nmountPath: {{ PATH_TO_CONFIG }}\n- mountPath: {{ PATH_TO_CONFIGMAP }}\nname: config\nsubPath: config.conf\n</code></pre> <p>First we use a busybox image which simply copies the content of our configmap to a folder which it shares with the container that is using the actual configmap.</p> <p>Sources:</p> <ul> <li>https://pabraham-devops.medium.com/mapping-kubernetes-configmap-to-read-write-folders-and-files-8a548c855817</li> </ul>"},{"location":"Kubernetes/data/#using-stakater-reloader-updating-config_mapssecrets","title":"Using stakater reloader updating config_maps/secrets","text":"<p>Sources:</p> <ul> <li>https://github.com/stakater/Reloader</li> </ul>"},{"location":"Kubernetes/data/#how-to-setup-persistent-volume-claimspvc-and-mounts","title":"How to setup Persistent Volume Claims(PVC) and Mounts?","text":""},{"location":"Kubernetes/data/#how-to-install-longhorn","title":"How to install longhorn?","text":"<p>First install iscsi manager</p> <pre><code>aptitude install open-iscsi\n</code></pre> <p>Longhorn is used to allow volumes persistsnce</p> <p>Pleas note, for this checkup to work correctly you need to run the check script as root.</p> <pre><code>aptitude install jq\n</code></pre> <pre><code>curl -sSfL https://raw.githubusercontent.com/longhorn/longhorn/v1.1.1/scripts/environment_check.sh | bash\n</code></pre> <p>Ingress controller for the dashboard must be created manually</p> <p>Sources:</p> <ul> <li>https://longhorn.io/docs/1.1.1/deploy/install/#using-the-environment-check-script</li> <li>https://longhorn.io/docs/1.1.1/deploy/install/install-with-helm/</li> <li>https://longhorn.io/docs/1.1.1/deploy/accessing-the-ui/longhorn-ingress/</li> <li>https://longhorn.io/docs/1.1.1/deploy/install/#installing-open-iscsi</li> </ul>"},{"location":"Kubernetes/data/#set-default-storage-class-in-cluster","title":"Set default storage class in cluster","text":"<p>first check default storage class in cluster:</p> <pre><code>kubectl get storageclass\n</code></pre> <p>Next set desired storage class / undefault previous default</p> <pre><code>kubectl patch storageclass local-path -p '{\"metadata\": {\"annotations\":{\"storageclass.kubernetes.io/is-default-class\":\"false\"}}}'\n</code></pre> <p>It seems like kubernetes is automatically resetting this which in turn makes completely removing local path the safest option.</p> <p>Sources:</p> <ul> <li>https://kubernetes.io/docs/tasks/administer-cluster/change-default-storage-class/</li> <li>https://github.com/k3s-io/k3s/issues/2767</li> </ul>"},{"location":"Kubernetes/data/#how-to-use-pvcs","title":"How to use PVCs?","text":"<p>Always use manual PVCs and existing claims in helm charts. That way you can be sure that the PVC is not accidentially dropped and the helm chart is always using the correct one.</p> <pre><code>apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\nname: longhorn-volv-pvc\nspec:\naccessModes:\n- ReadWriteOnce\nstorageClassName: longhorn\nresources:\nrequests:\nstorage: 2Gi\n</code></pre> <p>Sources:</p> <ul> <li>https://rancher.com/docs/k3s/latest/en/storage/</li> </ul>"},{"location":"Kubernetes/data/#mounting-subpath-vs-mount","title":"Mounting Subpath vs Mount","text":"<p>Sources:</p> <ul> <li>https://dev.to/joshduffney/kubernetes-using-configmap-subpaths-to-mount-files-3a1i</li> </ul>"},{"location":"Kubernetes/data/#subpath-mounting","title":"Subpath mounting","text":"<p>mounting a folder automatically leads to all existing contents to vanish. Like Mounting the folder /opt/something will lead to all contents of something to vanish. If this is not wanted one could instead use subPath. This avoids the aformentioned issues:</p> <pre><code>- name: {{ MOUNT_NAME }}\nmountPath: {{ /opt/yourfile.py }}\nsubpath: {{ yourfile.py }}\n</code></pre> <p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/33415913/whats-the-best-way-to-share-mount-one-file-into-a-pod</li> </ul>"},{"location":"Kubernetes/data/#what-is-readonlyonce-readonlymany-readwritemany","title":"What is ReadOnlyOnce / ReadOnlyMany / ReadWriteMany ?","text":"<p>First the the Once/Many is always about then number of nodes accessing a volume not the pods. On the same node many pods can always access a volume.</p> <p>Sources:</p> <ul> <li>https://stackoverflow.com/a/57799347</li> <li>https://stackoverflow.com/a/44322967</li> </ul>"},{"location":"Kubernetes/data/#how-to-mount-a-secret-as-env-variables","title":"How to mount a secret as env variables?","text":"<pre><code>env:\n- name: mysecretenv\nvalueFrom:\nsecretKeyRef:\nname: mysecret\nkey: password\n</code></pre> <p>Sources:</p> <ul> <li>https://kubernetes.io/docs/concepts/configuration/secret/#using-secrets-as-environment-variables</li> </ul>"},{"location":"Kubernetes/data/#how-to-mount-a-secret-as-files","title":"How to mount a secret as files?","text":"<pre><code>kubectl create secret generic --namespace {{ NAMESPACE  }} {{ SECRET_NAME }} \\\n--from-literal=users=$MYAUTH\n</code></pre> <p>Secrets can only be mounted fully so not as a single file in a folder</p> <pre><code>volumeMounts:\n- name: users\nmountPath: /secret/\nreadOnly: true\nvolumes:\n- name: users\nsecret:\nsecretName: {{ SECRET_NAME }}\n</code></pre> <p>Sources:</p> <ul> <li>https://www.jeffgeerling.com/blog/2019/mounting-kubernetes-secret-single-file-inside-pod</li> </ul>"},{"location":"Kubernetes/general/","title":"Kubernetes General","text":""},{"location":"Kubernetes/general/#translate-with-komposer","title":"Translate with Komposer","text":"<p>curl -L &lt;https://github.com/kubernetes/kompose/releases/download/v1.22.0/kompose-linux-amd64 -o kompose&gt;</p> <p>chmod +x kompose sudo mv ./kompose /usr/local/bin/kompose</p> <p>Sources:</p> <ul> <li>https://github.com/kubernetes/kompose</li> <li>https://kompose.io/getting-started/</li> </ul>"},{"location":"Kubernetes/general/#when-to-use-in-annotations-and-options","title":"When to use '\"' in annotations and options","text":"<p>Use when necessary (boolean and numbers). In most cases it is unnecessary and might cause problems.</p> <p>Sources:</p> <ul> <li>https://blog.jbrosi.dev/2019-3-nginx-ingress-rancher-basic-auth/</li> </ul>"},{"location":"Kubernetes/general/#what-are-labels-and-how-do-they-work","title":"What are labels and how do they work?","text":"<p>No idea, however, setting the wrong labels will result in resources not working together. It is important to set the same labels on collaborative resources like pods/services</p> <pre><code>selector:\nmatchLabels:\napp: {{ APP_NAME }}\ntemplate:\nmetadata:\nlabels:\napp: {{ APP_NAME }}\n</code></pre> <p>Labels are not used for core functionality and server mainly the purpose of helping the user to identify objects. Like this:</p> <pre><code>kubectl get pods -l environment=production,tier=frontend\n</code></pre> <p>In some cases like for services labels are used to identify the pods they belong to and thus can serve. If a service and a pod do not match in terms of their labels the service might not be able to find the pod.</p> <p>Kubernetes also has a set of recommended labels:</p> <pre><code>app.kubernetes.io/name: mysql\napp.kubernetes.io/instance: mysql-abcxzy\napp.kubernetes.io/version: \"5.7.21\"\napp.kubernetes.io/component: database\napp.kubernetes.io/part-of: wordpress\napp.kubernetes.io/managed-by: helm\napp.kubernetes.io/created-by: controller-manager\n</code></pre> <p>Sources:</p> <ul> <li>https://kubernetes.io/docs/concepts/overview/working-with-objects/labels/</li> <li>https://kubernetes.io/docs/concepts/overview/working-with-objects/common-labels/</li> </ul>"},{"location":"Kubernetes/general/#delete-multiple-resouce-types-from-namespace","title":"Delete multiple resouce types from namespace","text":"<pre><code>kubectl delete --namespace middleware --all deployments,pv,pvc,svc,ing\n</code></pre> <p>Use pattern matching for multiple resources and save delete:</p> <pre><code>kubectl delete pods -l app={{ LABEL_VALUE }} -n default\n</code></pre> <p>Sources:</p> <ul> <li>https://github.com/kubernetes/kubernetes/issues/39084</li> <li>https://stackoverflow.com/questions/59473707/kubenetes-pod-delete-with-pattern-match-or-wilcard</li> </ul>"},{"location":"Kubernetes/general/#label-a-node-and-node-affinity","title":"Label a node and node affinity","text":"<p>To make sure a Pod is always scheduled on a specific node one can use label:</p> <pre><code>kubectl label node k8s-node04 {{ LABEL_KEY }}={{ LABEL_VALUE }}\n</code></pre> <p>In our config yaml we use the affinity setting:</p> <pre><code>nodeAffinity:\nrequiredDuringSchedulingIgnoredDuringExecution:\nnodeSelectorTerms:\n- matchExpressions:\n- key: {{ LABEL_KEY }}\noperator: In\nvalues:\n- {{ LABEL_VALUE }}\n</code></pre> <p>Sources:</p> <ul> <li>https://nikdoof.com/posts/2021/zigbee2mqtt-on-kubernetes/</li> </ul>"},{"location":"Kubernetes/general/#how-to-control-cronjob-retries","title":"How to control CronJob retries","text":"<p>backoffLimit means the number of times it will retry before it is considered failed. The default is 6.</p> <p>concurrencyPolicy set to Forbid means it will run 0 or 1 times, but not more.</p> <p>restartPolicy set to Never means it won't restart on failure.</p> <p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/51657105/how-to-ensure-kubernetes-cronjob-does-not-restart-on-failure</li> </ul>"},{"location":"Kubernetes/installation/","title":"Kubernetes Installation","text":""},{"location":"Kubernetes/installation/#how-to-set-up-k3s","title":"How to set up k3s","text":"<p>First set up a master. The master installation already includes the worker node on the master.</p> <p>Check if certificate is correct otherwise run k3s serverwith tls-san</p> <p>Then install kubectl on your local computer. Check with kubectl cluster-info</p> <p>Install helm at local computer</p>"},{"location":"Kubernetes/installation/#installation-with-k3sup","title":"Installation with K3Sup","text":"<pre><code>k3sup install --ip {{ HOST_IP }} \\\n--user {{ SSH_USER }} \\\n--merge \\\n--local-path ~/.kube/config --context {{ CONTEXT NAME }} \\\n--k3s-version v1.25.5+k3s2 \\\n--k3s-extra-args '--disable local-storage --disable servicelb --disable traefik --flannel-backend wireguard-native'\n</code></pre> <p>Join new node:</p> <pre><code>k3sup join --ip {{ HOST_IP }} \\\n--user {{ SSH_USER }} \\\n--server-ip {{ SERVER_IP }} \\\n--server-user {{ SERVER_SSH_USER }} \\\n--k3s-version v1.25.5+k3s2 </code></pre> <p>Einzelnachweise:</p> <ul> <li>https://rancher.com/docs/k3s/latest/en/installation/install-options/server-config/#data</li> <li>https://github.com/alexellis/k3sup</li> </ul>"},{"location":"Kubernetes/installation/#helm","title":"Helm","text":""},{"location":"Kubernetes/installation/#use-helm3","title":"Use Helm3","text":"<p>Customize charts with yaml</p> <p>A few words on tillar</p> <p>The most important change in Helm 3 is the removal of Tiller. In Helm, prior to version 3, Tiller was the service that actually communicated with the Kubernetes API server to manage the Helm packages, and was running as an in-cluster service. The removal of Tiller, basically reduced the cluster risk surface.</p> <p>Sources:</p> <ul> <li>https://helm.sh/docs/intro/using_helm/#customizing-the-chart-before-installing</li> <li>https://www.alcide.io/helm-3-released-bye-bye-tiller-and-why-secops-should-care/</li> </ul>"},{"location":"Kubernetes/installation/#how-to-get-values-for-a-helm-template","title":"How to get values for a helm template?","text":"<p>To get existing user values:</p> <pre><code>helm get values {{ RELEASE_NAME }} &gt; values.yaml\n</code></pre> <p>to get default values</p> <pre><code>helm show values {{ CHART_REPOSITORY }} &gt; values.yaml\n</code></pre> <p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/64343656/grafana-dashboard-not-working-with-ingress</li> </ul>"},{"location":"Kubernetes/installation/#how-to-prerender-a-helm-template","title":"How to prerender a helm template?","text":"<pre><code>helm template {{ RELEASE_NAME }} -f values.yaml {{ CHART_REPOSITORY }} --create-namespace --namespace {{ NAMESPACE }}\n</code></pre> <p>Sources:</p> <ul> <li>https://helm.sh/docs/helm/helm_template/</li> </ul>"},{"location":"Kubernetes/installation/#how-to-get-all-versions-of-chart","title":"How to get all versions of chart?","text":"<pre><code>helm search repo {{ CHART_REPOSITORY }} --versions\n</code></pre> <p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/51031294/for-a-helm-chart-what-versions-are-available</li> </ul>"},{"location":"Kubernetes/installation/#deployment-order","title":"Deployment order","text":"<ol> <li>Longhorn</li> <li>Prometheus + Grafana</li> <li>nginx-ingress</li> <li>cert-manager</li> <li>cert-issuer</li> <li>keycloak</li> <li>minio</li> <li>...regular applications</li> </ol>"},{"location":"Kubernetes/installation/#set-auto-upgrade","title":"Set auto upgrade","text":"<p>Sources:</p> <ul> <li>https://rancher.com/docs/k3s/latest/en/upgrades/automated/</li> </ul>"},{"location":"Kubernetes/network/","title":"Kubernetes Network","text":""},{"location":"Kubernetes/network/#port-forwarding-reach-pod-inside-network","title":"Port Forwarding / Reach Pod inside network","text":"<p>If you want to reach a service inside the pod you can simply forward the port to your local machine. This makes the need for public ingress obsolete at least for some cases.</p> <pre><code>kubectl --namespace {{ NAMESPACE_NAME }} port-forward svc/{{ SVC_NAME }} 9090:9090\n</code></pre> <p>Sources:</p> <ul> <li>https://kubernetes.io/docs/tasks/access-application-cluster/port-forward-access-application-cluster/</li> </ul>"},{"location":"Kubernetes/network/#get-pods-dns-name-ip-address","title":"Get Pods DNS name / IP address","text":"<p>Currently when a pod is created, its hostname is the Pod's metadata.name value. The Pod spec has an optional hostname field, which can be used to specify the Pod's hostname.</p> <pre><code>{{ POD_NAME }}.my-namespace\n</code></pre> <p>Please note: In most cases you want to reference the service DNS record since that is the actual entrypoint to your Pod.</p> <pre><code>service-name.my-namespace\n</code></pre> <p>Note however that using the namespace is not necessary if pods/services are in the same namespace.</p> <p>Container in the same pod share a virtual network and thus simply use \"127.0.0.1\" if they want to reach each other.</p> <p>Sources:</p> <ul> <li>https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/#pod-s-hostname-and-subdomain-fields</li> <li>https://stackoverflow.com/a/59558862</li> </ul>"},{"location":"Kubernetes/network/#nodeport-and-port-on-hosts-and-how-to-use-port-outside-standard-range","title":"NodePort and port on Hosts and how to use port outside standard range","text":"<p>Using the following adjusted start commands to /etc/systemd/system/multi-user.target.wants/k3s.service</p> <pre><code>--service-node-port-range 53-54\n</code></pre> <p>will allow us to use ports 53-54. Now using a nodeport will reroute all traffic on all nodes incoming to port 53 to our service. We need to use the nodePort parameter to insure a specific port is used.</p> <pre><code>apiVersion: v1\nkind: Service\nmetadata:\nname: adguard-adguard-home-dns\nspec:\nselector:\napp.kubernetes.io/name: adguard-home\napp.kubernetes.io/instance: adguard\ntype: NodePort\nports:\n- port: 53\nname: dns-tcp\ntargetPort: dns-tcp\nnodePort: 53\nprotocol: TCP\n</code></pre> <p>With this it is not possible to use multiple ranges. However that seems to be possible but was not tested(see sources).</p> <p>Sources:</p> <ul> <li>https://medium.com/google-cloud/kubernetes-nodeport-vs-loadbalancer-vs-ingress-when-should-i-use-what-922f010849e0</li> <li>https://alesnosek.com/blog/2017/02/14/accessing-kubernetes-pods-from-outside-of-the-cluster/</li> <li>https://kubernetes.io/docs/concepts/services-networking/service/#type-nodeport</li> <li>https://rancher.com/docs/k3s/latest/en/installation/install-options/server-config/</li> <li>https://stackoverflow.com/a/59679905</li> </ul>"},{"location":"Kubernetes/network/#install-ingress-controller-nginx","title":"Install ingress controller nginx","text":"<p>altered the default command to</p> <pre><code>helm install ingress-nginx ingress-nginx/ingress-nginx --namespace ingress-nginx --create-namespace\n</code></pre> <p>Otherwise it would create nginx in the wrong namespace(default)</p> <ul> <li>https://kubernetes.github.io/ingress-nginx/deploy/#bare-metal</li> </ul> <p>Sources:</p> <ul> <li>https://rancher.com/docs/k3s/latest/en/installation/install-options/#options-for-installation-with-script</li> <li>https://helm.sh/docs/intro/install/</li> <li>https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/#install-using-native-package-management</li> <li>https://rancher.com/docs/k3s/latest/en/cluster-access/</li> <li>https://stackoverflow.com/questions/46360361/invalid-x509-certificate-for-kubernetes-master</li> <li>https://github.com/k3s-io/k3s/issues/214#issuecomment-482388852</li> <li>https://stackoverflow.com/questions/51783651/how-to-create-a-namespace-if-it-doesnt-exists-from-helm-templates</li> </ul>"},{"location":"Kubernetes/network/#how-to-install-cert-manager","title":"How to install Cert-manager","text":"<p>Sources:</p> <ul> <li>https://cert-manager.io/docs/installation/kubernetes/</li> </ul>"},{"location":"Kubernetes/network/#default-ingress","title":"Default Ingress","text":"<pre><code>ingressclass.kubernetes.io/is-default-class\n</code></pre> <p>Sources:</p> <ul> <li>https://kubernetes.github.io/ingress-nginx/#i-have-only-one-ingress-controller-in-my-cluster-what-should-i-do</li> </ul>"},{"location":"Kubernetes/network/#protect-ingress-with-basic-auth","title":"Protect ingress with basic auth","text":"<p>Add annotations to ingress:</p> <pre><code>nginx.ingress.kubernetes.io/auth-type: basic\nnginx.ingress.kubernetes.io/auth-secret: basic-auth\nnginx.ingress.kubernetes.io/auth-realm: 'Authentication Required '\n</code></pre> <p>basic-auth is the name of our secret which contains the basic auth. The secret needs to contain a key \"auth\" which contains the md5 string.</p> <p>Sources:</p> <ul> <li>https://longhorn.io/docs/1.1.2/deploy/accessing-the-ui/longhorn-ingress/</li> </ul>"},{"location":"Kubernetes/network/#protect-images-with-oauth2","title":"Protect images with oauth2","text":"<p>Use the predefined oauth2 service and keycloak application json. The following annotation can be used to protect services:</p> <pre><code>nginx.ingress.kubernetes.io/auth-url: \"https://{{ SSO_URL }}/oauth2/auth\"\nnginx.ingress.kubernetes.io/auth-signin: \"https://{{ SSO_URL }}/oauth2/start?rd=$scheme://$best_http_host$request_uri\"\nnginx.ingress.kubernetes.io/auth-response-headers: \"x-auth-request-user, x-auth-request-email, x-auth-request-access-token\"\nacme.cert-manager.io/http01-edit-in-place: \"true\"\nnginx.ingress.kubernetes.io/proxy-buffer-size: \"16k\"\n</code></pre> <p>Sources:</p> <ul> <li>https://www.talkingquickly.co.uk/webapp-authentication-keycloak-OAuth2-proxy-nginx-ingress-kubernetes</li> <li>https://github.com/oauth2-proxy/manifests/tree/main/helm/oauth2-proxy</li> <li>https://www.talkingquickly.co.uk/installing-keycloak-kubernetes-helm</li> </ul>"},{"location":"Kubernetes/network/#use-configuration-snippets-to-add-custom-headers","title":"Use configuration snippets to add custom headers","text":"<pre><code>nginx.ingress.kubernetes.io/configuration-snippet: |-\nproxy_set_header X-Remote-User $remote_user;\n</code></pre> <p>Sources:</p> <ul> <li>https://kubernetes.github.io/ingress-nginx/examples/customization/configuration-snippets/</li> </ul>"},{"location":"Kubernetes/pods/","title":"Kubernetes Pods","text":""},{"location":"Kubernetes/pods/#run-a-command-inside-a-pod","title":"Run a command inside a pod","text":"<pre><code>kubectl exec -stdin --namespace {{ NAMESPACE }} --tty {{ POD_NAME }} -- /bin/bash -c \"echo 1;\"\n</code></pre> <p>as another user:</p> <pre><code>kubectl exec --stdin --namespace {{ NAMESPACE }} --tty {{ POD_NAME }} -- su -s /bin/bash www-data -c \"php occ --version\"\n</code></pre> <p>Sources:</p> <ul> <li>https://kubernetes.io/docs/tasks/debug-application-cluster/get-shell-running-container/</li> <li>https://unix.stackexchange.com/a/372851</li> <li>https://github.com/kubernetes/kubernetes/issues/30656#issuecomment-738687664</li> </ul>"},{"location":"Kubernetes/pods/#restart-a-podsstatefulsetdeployment","title":"Restart a pods/statefulset/deployment","text":"<p>Use:</p> <pre><code>kubectl rollout restart statefulset\n</code></pre> <p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/59168406/kubectl-rollout-restart-for-statefulset</li> </ul>"},{"location":"Kubernetes/pods/#update-deployments","title":"Update deployments","text":"<p>You simply update the image tag in the pods description</p> <pre><code>kubectl set image deployment/nginx-deployment nginx=nginx:1.16.1 --record\n</code></pre> <p>Sources:</p> <ul> <li>https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#updating-a-deployment</li> </ul>"},{"location":"Kubernetes/pods/#copy-to-container-inside-pods-from-local","title":"Copy to container inside pods from local","text":"<pre><code>kubectl cp --namespace {{ NAMESPACE_NAME }} {{ PATH_TO_LOCAL_FILE }} {{ POD_NAME }}:{{ POD_PATH }} -c {{ CONTAINER_NAME }}\n</code></pre> <p>Sources:</p> <ul> <li>https://kubernetes.io/docs/reference/kubectl/cheatsheet/?ref=hackernoon.com#copy-files-and-directories-to-and-from-containers</li> </ul>"},{"location":"Kubernetes/pods/#get-logs","title":"Get Logs","text":"<pre><code>kubectl logs --namespace {{ NAMESPACE }} {{ POD_NAME }}\n</code></pre> <pre><code>kubectl logs -f deployment/{{ name-of-deployment }}\n</code></pre> <p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/60518658/how-to-get-logs-of-deployment-from-kubernetes#62831466</li> </ul>"},{"location":"Kubernetes/pods/#get-logs-of-failed-containers","title":"Get logs of failed containers","text":"<pre><code>sudo more /var/log/containers/\n</code></pre> <p>Sources:</p> <ul> <li>https://stackoverflow.com/a/64626323</li> </ul>"},{"location":"Kubernetes/pods/#run-a-prestarthook","title":"Run a preStartHook","text":"<p>Always keep in mind that the very first argument in the command call is the binary and the binary only!! That works:</p> <pre><code>postStartCommand: [\"/bin/sh\", \"-c\", \"echo 1\"]\n</code></pre> <p>That too:</p> <pre><code>postStart:\nexec:\ncommand: [\"/bin/sh\", \"-c\", \"echo 1\"]\n</code></pre> <p>This does not</p> <pre><code>postStartCommand: [\"/bin/sh -c\", \"echo 1\"]\n</code></pre>"},{"location":"Kubernetes/pods/#get-a-pod-with-bash-for-debugging","title":"Get a pod with bash for debugging","text":"<pre><code>kubectl run -i --tty alpine --image=alpine --restart=Never -- sh\n</code></pre> <p>Sources:</p> <ul> <li>https://kubernetes.io/docs/reference/kubectl/cheatsheet/#interacting-with-running-pods</li> <li>https://kubernetes.io/blog/2015/10/some-things-you-didnt-know-about-kubectl_28/#run-interactive-commands</li> </ul>"},{"location":"Kubernetes/pods/#analyze-pod-pending","title":"Analyze Pod Pending","text":"<p>Can potentially be found to be struggling with insufficient cpu. Check the cpu usage with:</p> <pre><code>kubectl get nodes\nkubectl describe node {{ NODE_NAME }}\n</code></pre> <p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/38869673/pod-in-pending-state-due-to-insufficient-cpu</li> </ul>"},{"location":"Kubernetes/pods/#how-to-use-and-set-resource-limitations-in-kubernetes","title":"How to use and set resource limitations in kubernetes","text":"<p>Use this command to evaluate the current usage of container. This can potentially be used to evaluate the real usage.</p> <pre><code>kubectl top pod {{ POD_NAME }} --namespace {{ NAMESPACE  }}\n</code></pre> <p>Sources:</p> <ul> <li>https://cloud.google.com/blog/products/containers-kubernetes/kubernetes-best-practices-resource-requests-and-limits</li> <li>https://kubernetes.io/docs/tasks/configure-pod-container/assign-memory-resource/#if-you-do-not-specify-a-memory-limit</li> </ul>"},{"location":"Kubernetes/troubleshooting/","title":"Kubernetes Troubleshooting","text":""},{"location":"Kubernetes/troubleshooting/#nameserver-limit-exceeded","title":"Nameserver limit exceeded","text":"<p>Fix by removing namespace entries from /etc/resolv.conf</p> <p>Sources:</p> <ul> <li> <p>https://www.reddit.com/r/kubernetes/comments/7ruq0f/kubelet_nameserver_limits_were_exceeded/</p> </li> <li> <p>Error: unable to build kubernetes objects from release manifest: unable to recognize \"\": no matches for kind \"ServiceMonitor\" in version \"monitoring.coreos.com/v1\" - Prometheus not yet installed thus resource ServiceMonitor unknown.</p> </li> </ul>"},{"location":"Kubernetes/troubleshooting/#mounts","title":"Mounts","text":""},{"location":"Kubernetes/troubleshooting/#how-to-troubleshoot","title":"How to troubleshoot?","text":"<p>First check the pvc and pv available:</p> <pre><code>kubectl get pv, pvc\n</code></pre> <p>Get description of relevant pv and check what their status is</p> <pre><code>kubectl describe pvc {{ my-pvc }}\n</code></pre> <p>If there are no erros check the longhorn GUI that should show you the claims status. If status is \"detached\" you need to check the node status in Node. This might be unschedulable if that is the case get the node description.</p> <pre><code>kubectl -n longhorn-system get nodes.longhorn.io\nkubectl -n longhorn-system describe nodes.longhorn.io {{ my-node }}\n</code></pre> <p>Check the disk status in the description. Especially the Disk Status &gt; {{ DISK_NAME }} &gt; Conditions most likely the Schedulable entry should give you some indication. Possible status could be disk pressure or something similar indicating that there is not enough space on disk.</p> <p>Sources:</p> <ul> <li>https://github.com/longhorn/longhorn/issues/971</li> <li>https://stackoverflow.com/questions/62215795/pod-has-unbound-immediate-persistentvolumeclaims-repeated-3-times</li> <li>https://longhorn.io/docs/1.1.1/volumes-and-nodes/multidisk/#configuration</li> </ul>"},{"location":"Kubernetes/troubleshooting/#mount-attach-failed-volume-mount-fail-with-exit-status-32","title":"Mount Attach failed: volume mount fail with exit status 32","text":"<p>Turned out to be an nfs issues and was solved by installing</p> <pre><code>sudo apt-get install -y nfs-common # nfs-kernel-server\n</code></pre> <p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/34113569/kubernetes-nfs-volume-mount-fail-with-exit-status-32</li> <li>https://stackoverflow.com/questions/47423453/mountvolume-setup-failed-for-volume-nfs-mount-failed-exit-status-32</li> </ul>"},{"location":"Kubernetes/troubleshooting/#mount-point-busy-or-already-mounted","title":"Mount point busy or already mounted","text":"<p>Seems to be an issues with multipath and can be resolved by altering multipath config.</p> <pre><code>vi /etc/multipath.conf\n</code></pre> <p>add lines</p> <pre><code>blacklist {\n    devnode \"^sd[a-z0-9]+\"\n}\n</code></pre> <p>restart</p> <pre><code>systemctl restart multipathd\n</code></pre> <p>Sources:</p> <ul> <li>https://longhorn.io/kb/troubleshooting-volume-with-multipath/</li> </ul>"},{"location":"Python/advanced/","title":"Python Advanced","text":""},{"location":"Python/advanced/#how-do-i-migrate-my-database-solution-with-python","title":"How do I migrate my database solution with python?","text":"<p>Use Alembic python library to do that.</p> <pre><code>alembic init ./alembic\n</code></pre> <p>or for async alembic</p> <pre><code>alembic init -t async ./alembic\n</code></pre> <p>After that we need to fill the config alembic.ini in ./.</p> <p>First we need to remove one line:</p> <pre><code>sqlalchemy.url = driver://user:pass@localhost/dbname\n</code></pre> <p>Second, we need to add an init.py file in the ./alembic/ folder and alter the ./alembic/env.py file:</p> <ul> <li>First alter the import engine_from_config to your used engine (like create_engine)</li> <li>add your logger instead of logging.config (like from app.logger import logger) + comment \"fileConfig(config.config_file_name)\"</li> <li>remove from sqlalchemy import pool</li> </ul> <p>Import your base class</p> <pre><code>from app.db.base import Base\ntarget_metadata = Base.metadata\n</code></pre> <p>import your url function</p> <pre><code>from app.db.get_url import get_url\n</code></pre> <p>Use get url function instead of</p> <pre><code>config.get_main_option(\"sqlalchemy.url\")\n</code></pre> <p>add \", compare_type=True\"</p> <p>now you are ready to create revisions:</p> <pre><code>alembic revision --autogenerate -m \"{{ DESCRIPTION }}\"\n</code></pre> <p>Sources:</p> <ul> <li>https://alembic.sqlalchemy.org/en/latest/autogenerate.html</li> <li>https://alembic.sqlalchemy.org/en/latest/cookbook.html#using-asyncio-with-alembic</li> </ul>"},{"location":"Python/advanced/#how-to-use-type-hints-for-return-of-self-in-classes","title":"How to use type hints for return of \"self\" in classes?","text":"<pre><code>from __future__ import annotations\n</code></pre> <p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/33533148/how-do-i-type-hint-a-method-with-the-type-of-the-enclosing-class</li> </ul>"},{"location":"Python/advanced/#sqlalchemy-20","title":"SQLALchemy 2.0","text":""},{"location":"Python/advanced/#result-object-and-mappings-with-column-names","title":"Result Object and Mappings with column names","text":"<pre><code>result = (await db.execute(time_aggregation_select)).mappings().all()\n</code></pre> <p>Sources:</p> <ul> <li>https://docs.sqlalchemy.org/en/14/core/connections.html#sqlalchemy.engine.Result</li> </ul>"},{"location":"Python/basics/","title":"Python Basics","text":""},{"location":"Python/basics/#what-is-the-purpose-of-initpy","title":"What is the purpose of init.py?","text":"<p>This files indicates that the current folder is a submodule or module of a package or application. It has two main functions:</p> <ol> <li>Allow python parsers like pylint to understand that they are in a subfolder and need to move up to get to the rootfolder of a package (without init.py)</li> <li>It allows one to import functions of a module without referencing every single file. Instead one can simply import the module and this will automatically import all methods/functions/classes that are referenced in the init.py file. Example:</li> </ol> <p>Mypackage main.py -mymodule --init.py --myfunction.py</p> <p>We could now either import like</p> <pre><code>import mymodule as module\n</code></pre> <p>in this case every function import inside the init.py would be imported.</p> <p>PLEASE NOTE: The searchpath always starts at wherever the input file was localted. Thus your main.py should always be in the top directory!!!!</p> <p>\"The directory containing the input script (or the current directory when no file is specified).\"</p> <p>|_myproj   -main.py   -module1   --something.py   -module2</p> <p>Sources:</p> <ul> <li>https://docs.python.org/3/tutorial/modules.html#the-module-search-path</li> </ul>"},{"location":"Python/basics/#how-do-i-use-python-f-strings","title":"How do I use python f strings?","text":"<p>Sources:</p> <ul> <li>https://realpython.com/python-f-strings/</li> </ul>"},{"location":"Python/basics/#tests","title":"Tests","text":""},{"location":"Python/basics/#how-do-i-write-tests","title":"How do I write tests?","text":"<p>Use pytest for that. Fixtures can be used to definde stuff that is available to all tests. These are stored in the \"conftest.py\" file. Please note that all files and function names should be included in the test (except for conftest.py) should use the prefix \"test_\".</p>"},{"location":"Python/basics/#how-do-i-generate-test-data","title":"How do I generate test data?","text":"<p>Use factory_boy for classes and faker standalone for primitive types.</p> <p>Sources:</p> <ul> <li>https://faker.readthedocs.io/en/stable/pytest-fixtures.html</li> <li>https://github.com/FactoryBoy/factory_boy</li> </ul>"},{"location":"Python/snippets/","title":"Python Snippets","text":""},{"location":"Python/snippets/#how-do-i-get-a-counter-in-a-for-loop","title":"How do I get a counter in a for loop?","text":"<p>Use enumerate:</p> <pre><code>for idx, row in enumerate(all_rows):\nif idx &gt;= 12:\nsomething\n</code></pre>"},{"location":"Python/snippets/#how-to-transform-a-list-of-dicts-to-dict","title":"How to transform a list of dicts to dict?","text":"<p>use Chainmap:</p> <pre><code>from collections import ChainMap\nlist_of_dict = [{1:2}, {2: 3}]\ndict = dict(ChainMap(*list_of_dict))\n</code></pre> <p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/5236296/how-to-convert-list-of-dict-to-dict</li> </ul>"},{"location":"Python/snippets/#how-to-build-nested-list-comprehensions","title":"How to build nested list comprehensions?","text":"<p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/18072759/list-comprehension-on-a-nested-list</li> </ul>"},{"location":"Python/snippets/#transform-json-to-yaml-and-back","title":"Transform json to yaml and back","text":"<pre><code>python -c 'import json; import yaml; print(yaml.dump(json.load(open(\"{{ PATH_TO_JSON }}\"))))'\n</code></pre> <p>Sources:</p> <ul> <li>https://stackoverflow.com/a/55924692</li> </ul>"},{"location":"Python/troubleshooting/","title":"Python Troubleshooting","text":""},{"location":"Python/troubleshooting/#postgres-psycopg-scram-authentication","title":"Postgres PSYCOPG SCRAM Authentication","text":"<p>Seems to be a driver problem with the aarm 64 Driver using an old library.</p> <p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/69573312/python-psycopg2-scram-authentication</li> </ul>"},{"location":"Terminal/advanced/","title":"Terminal Advanced","text":""},{"location":"Terminal/advanced/#how-do-i-retrieve-the-unique-cpu-signatur-id","title":"How do I retrieve the unique cpu signatur id?","text":"<p>Install hwinfo:</p> <pre><code>sudo apt-get install hwinfo\n</code></pre> <p>Retrieve info and look for Unique ID:</p> <pre><code>hwinfo --cpu\n</code></pre> <p>Sources:</p> <ul> <li>https://linuxhandbook.com/check-cpu-info-linux/</li> </ul>"},{"location":"Terminal/advanced/#how-do-i-set-a-env-variable-for-all-users","title":"How do I set a env variable for all users?","text":"<pre><code>echo \"export BORG_PASSPHRASE={{ PASSPHRASE }}\" &gt;&gt; /etc/profile\n</code></pre> <p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/1641477/how-to-set-environment-variable-for-everyone-under-my-linux-system</li> </ul>"},{"location":"Terminal/advanced/#how-do-i-grab-a-env-variable-from-a-remote-machine-with-ssh","title":"How do I grab a env variable from a remote machine with ssh?","text":"<p>ssh runs a non interactive shell and thus the number of env variables can be significantly smaller then in normal mode. I started to simply use:</p> <pre><code>ssh oph \"source /etc/profile; printenv | grep BORG | rev | cut -d '=' -f 1 | rev\"\n</code></pre> <p>Sources:</p> <ul> <li>https://superuser.com/questions/952084/why-is-ssh-not-invoking-bash-profile</li> <li>https://stackoverflow.com/questions/43775801/use-environment-variables-of-remote-server-in-ssh-command</li> <li>https://stackoverflow.com/questions/216202/why-does-an-ssh-remote-command-get-fewer-environment-variables-then-when-run-man</li> </ul>"},{"location":"Terminal/advanced/#how-to-find-which-devices-are-connected-to-network-in-linux","title":"How to find which devices are connected to network in Linux?","text":"<pre><code>sudo aptitude install nmap\n</code></pre> <p>lese IP Range ab</p> <pre><code>ip a\n</code></pre> <p>setze scan parameter nach CIDR notation</p> <pre><code>sudo nmap -sn 192.168.178.0/24\n</code></pre> <p>Sources:</p> <ul> <li>https://itsfoss.com/how-to-find-what-devices-are-connected-to-network-in-ubuntu/</li> </ul>"},{"location":"Terminal/advanced/#how-do-i-find-connected-and-unmounted-devices-or-devices","title":"How do I find connected and unmounted devices or devices ?","text":""},{"location":"Terminal/advanced/#regular-unencrypted","title":"Regular unencrypted","text":"<p>You can also use the lsblk command (list block devices) which lists all block devices attached to your system. To view each device attached to your system as well as its mount point, you can use the df command (checks Linux disk space utilization) as shown in the image below:</p> <pre><code>lsblk\ndf -h\n</code></pre> <p>for mounting</p> <pre><code>sudo mkdir {{ PATH_TO_MOUNTPOINT }}\nsudo mount /dev/sdb1 {{ PATH_TO_MOUNTPOINT }}\n</code></pre> <p>Sources:</p> <ul> <li>https://www.tecmint.com/find-usb-device-name-in-linux/</li> <li>https://askubuntu.com/questions/285539/detect-and-mount-devices</li> </ul>"},{"location":"Terminal/advanced/#how-to-mount-encrypted-devices","title":"How to mount encrypted devices ?","text":"<p>First unlock device:</p> <pre><code>sudo udisksctl unlock -b /dev/sdb1\n</code></pre> <p>now mount it using the unlock endpoint:</p> <pre><code>ls -la /dev/mapper\nsudo mount /dev/dm-0 {{ PATH_TO_MOUNTPOINT }}\n</code></pre> <p>Sources:</p> <ul> <li>https://askubuntu.com/questions/63594/mount-encrypted-volumes-from-command-line</li> </ul>"},{"location":"Terminal/advanced/#how-to-mount-an-encrypted-luks-device-automatically","title":"How to mount an encrypted LUKS device automatically?","text":"<p>First list all devices with luks</p> <pre><code>lsblk --fs\n</code></pre> <p>List all available keys for the device and add a new one</p> <pre><code>cryptsetup luksDump /dev/sdb1\ncryptsetup luksAddKey /dev/sdb1\n</code></pre> <p>Simply enter the correct passphrase if asked for existing passphrase. Validate with</p> <pre><code>cryptsetup luksDump /dev/sdb1\n</code></pre> <p>Create a lukskey than can be used to automount the device at boot. We will first create a new key with random content. Next we will fill it with the real key.</p> <pre><code>dd if=/dev/random bs=32 count=1 of=/root/lukskey\nchmod 0600 /root/lukskey\ncryptsetup luksAddKey /dev/sdb1 /root/lukskey\ncryptsetup luksDump /dev/sdb1\n</code></pre> <p>create new cryttab entry (watchout to choose correct mountpoint \"backup\" in /etc/fstab)</p> <pre><code>cryptsetup luksDump /dev/sdb1 | grep \"UUID\"\necho \"sdb1_crypt UUID={{ MY_UID }}   /root/lukskey\" &gt;&gt; /etc/crypttab\n</code></pre> <p>create new fstab entry and mountpoint</p> <pre><code>echo \"/dev/mapper/sdb1_crypt      {{ PATH_TO_MOUNTPOINT }}   ext4    defaults    rw,user,exec     0    0\" &gt;&gt; /etc/fstab\nmkdir /mnt/backup\nchmod 777 /mnt/backup\n</code></pre> <p>TO test:</p> <pre><code>cryptdisks_start sdb1_crypt\nmount {{ PATH_TO_MOUNTPOINT }}\n</code></pre> <p>Sources:</p> <ul> <li>https://bbs.archlinux.org/viewtopic.php?id=164798</li> <li>https://www.golinuxcloud.com/mount-luks-encrypted-disk-partition-linux/</li> <li>https://blog.tinned-software.net/automount-a-luks-encrypted-volume-on-system-start/</li> </ul>"},{"location":"Terminal/advanced/#how-do-i-find-a-process-and-its-consumption","title":"How do I find a process and its consumption?","text":"<pre><code>ps aux | grep {{ PROCESS_YOU_LOOK_FOR }}\n</code></pre>"},{"location":"Terminal/advanced/#how-to-check-if-env-exist-or-set-it-to-default-if-not-exist","title":"How to check if env exist or set it to default if not exist?","text":"<p>Simply use</p> <pre><code>\"${MYVAR:-default_value}\"\n</code></pre> <p>for check use:</p> <pre><code>if [\"${MYVAR:-default_value}\" = \"default_value\"]\n</code></pre>"},{"location":"Terminal/advanced/#how-do-i-determine-the-number-size-of-all-files-in-a-folder","title":"How do I determine the number / size of all files in a folder?","text":"<p>Option a for all files and subfolders</p> <pre><code>du -sh * | sort -hr\n</code></pre> <p>Size in the sense of quantity</p> <pre><code>find . -type d | wc -l\n</code></pre> <p>for specific file types</p> <pre><code>find {{ PATH_TO_FOLDER }} -mindepth 1 -type f -name \"*.mp4\" -printf x | wc -c\n</code></pre> <p>Important if</p> <p>The problem seemed to be is that du insists on reporting the disk usage of directories and files, and I wanted only the size of files. So, since creating a few directories will use more bytes on some filesystems, and less on others, you get a difference.</p> <p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/1019116/using-ls-to-list-directories-and-their-total-sizes</li> <li>https://www.shellhacks.com/count-number-files-directory/</li> <li>https://askubuntu.com/questions/454564/count-total-number-of-files-in-particular-directory-with-specific-extension/454568</li> </ul>"},{"location":"Terminal/advanced/#how-to-copy-a-file-from-a-to-b-via-ssh-or-scp","title":"How to copy a file from a to b via SSH or SCP?","text":"<pre><code>scp -r {{ REMOTE }}:{{ SOURCE_FOLDER }} {{ SINK_FOLDER }}\n</code></pre> <p>The r option stands for recursive</p>"},{"location":"Terminal/advanced/#how-to-check-listeners-on-ports","title":"How to check listeners on ports?","text":"<pre><code>netstat -tunlp\n</code></pre> <p>oder neuere Variante</p> <pre><code>sudo ss -tunlp\n</code></pre> <p>Sources:</p> <ul> <li>https://linuxize.com/post/check-listening-ports-linux/#check-listening-ports-with-ss</li> </ul>"},{"location":"Terminal/basics/","title":"Terminal Basics","text":""},{"location":"Terminal/basics/#how-do-i-get-a-root-shell","title":"How do I get a root shell?","text":"<p>The correct way is to use sudo -s (shell with your current environment) or sudo -i (login shell)</p> <p>Sources:</p> <ul> <li>https://askubuntu.com/questions/978300/how-do-i-set-environment-variable-for-all-users-even-when-doing-sudo-su</li> </ul>"},{"location":"Terminal/basics/#how-do-i-reverse-search-my-commands","title":"How do I reverse search my commands?","text":"<p>CTRL + R</p> <p>Sources:</p> <ul> <li>https://unix.stackexchange.com/questions/73498/how-to-cycle-through-reverse-i-search-in-bash</li> </ul>"},{"location":"Terminal/basics/#how-do-i-use-if-in-bash","title":"How do I use if in bash?","text":"<pre><code>if [ \"$(iwgetid -r)\" == \"{{ WIFI_NAME }}\" ]; then echo \"true\"; fi\n</code></pre> <p>um das eigentliche Problem mit dings zu l\u00f6sen</p> <pre><code>if [ -d \"{{ MY_FOLDER }}\" ]; then echo \"true\"; fi\n</code></pre> <p>ganz wichtig sind die spaces nach und vor den eckigen Klammern Dies l\u00e4sst sich auch auf remote systems anwenden:</p> <pre><code>if [ \"$(ssh {{ USER }}@{{ HOST }} ls -l {{ FOLDER_PATH }})\" == \"{{ SOME_FILE }}\" ]; then ...\n</code></pre> <p>or even simpler use(bash):</p> <pre><code>if ssh {{ REMOTE_NAME }} test -e {{ PATH_TO_TEST }} ; then echo \"true\"; fi\n</code></pre> <p>Achtung es gibt Unterschied zwischen sh und bash bei if z.B. akzeptiert bash \"==\" sh aber nur \"=\" zudem funktioniert <code>\"$(iwgetid -r)\" = \"VF\"</code> wunderbar in bash aber nur als <code>if [ $(iwgetid -r) = \"{{ WIFI_NAME }}\" ]</code> in sh. Das gilt insbesondere f\u00fcr das ausf\u00fchren von commands, diese k\u00f6nnen in bash in \"\" gesetzt werden, in sh m\u00fcssen sie innerhalb eines <code>$()</code> gesetzten werden.</p> <p>Scheinbar d\u00fcrfen commands die Booleans zur\u00fcckgeben auch nicht in [...] gefasst werden.</p> <p>sh:</p> <pre><code>if [ $(iwgetid -r) = \"{{ WIFI_NAME }}\" ]\nthen if [ $(ssh {{ REMOTE_NAME }} \"test -e {{ PATH_TO_TEST }}\") ]\n</code></pre> <p>Sources:</p> <ul> <li>https://www.cyberciti.biz/faq/howto-check-if-a-directory-exists-in-a-bash-shellscript/</li> <li>https://askubuntu.com/questions/117065/how-do-i-find-out-the-name-of-the-ssid-im-connected-to-from-the-command-line</li> <li>https://askubuntu.com/questions/612100/what-is-the-syntax-for-if-else-in-bash</li> <li>http://tldp.org/LDP/abs/html/comparison-ops.html</li> <li>https://askubuntu.com/questions/707785/command-to-compare-two-strings</li> <li>https://stackoverflow.com/questions/5725296/difference-between-sh-and-bash</li> <li>https://serverfault.com/questions/242176/is-there-a-way-to-do-a-remote-ls-much-like-scp-does-a-remote-copy</li> <li>https://stackoverflow.com/questions/12845206/check-if-file-exists-on-remote-host-with-ssh</li> </ul>"},{"location":"Terminal/basics/#find","title":"Find","text":"<p>\"-iname\" for i flag bei find \"-exec\" f\u00fchrt alle commands nach dem ersten aus und \u00fcbergibt parameter? Beendet mit \"\\;\"</p> <p>Sources:</p> <ul> <li>https://www.cyberciti.biz/faq/linux-unix-how-to-find-and-remove-files/</li> </ul>"},{"location":"Terminal/basics/#how-do-i-compress-tar-multiple-folders-and-exclude-some","title":"How do I compress tar multiple folders and exclude some?","text":"<p>with the following everything fits</p> <pre><code>tar -cvzf {{ TARGET_ARCHIVE }} --exclude='__pycache__'  {{ source_file}} {{ SOURCE_FILE_2 }}\n</code></pre> <p>the -z specifies here gzip as target compression extract the archive with</p> <pre><code>tar -xzvf {{ SOURCE_ARCHIVE }} -C {{ PATH_TO_TARGET_FOLDER }}\n</code></pre> <p>-C specifies the target directory here.</p> <p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/984204/shell-command-to-tar-directory-excluding-certain-files-folders</li> <li>https://www.howtogeek.com/248780/how-to-compress-and-extract-files-using-the-tar-command-on-linux/</li> </ul>"},{"location":"Terminal/basics/#how-do-i-read-permission-and-change-it-with-chmod","title":"How do I read permission and change it with chmod?","text":"<pre><code>chown {{ USER }}:{{ USER_GROUP }} {{ PATH_TO_FILE }}\nchmod +x {{ PATH_TO_FILE }}\n</code></pre> <p>for recursive use -R</p> <pre><code>chmod -R 755 {{ PATH_TO_FOLDER }}\nchown -R {{ USER }}:{{ USER_GROUP }} {{ PATH_TO_FOLDER }}\n</code></pre> <p>In general, however, it is better to combine the whole thing with find, because then files do not get an x (execute).</p> <pre><code>find {{ PATH_TO_FOLDER }} -type d -exec chmod 0750 {} \\;\nfind {{ PATH_TO_FOLDER }} -type f -exec chmod 0640 {} \\;\n</code></pre> <p>Sources:</p> <ul> <li>https://www.linode.com/docs/tools-reference/tools/modify-file-permissions-with-chmod/</li> <li>https://help.ubuntu.com/community/FilePermissions</li> </ul>"},{"location":"Terminal/basics/#how-can-i-find-out-which-candidate-versions-of-which-packages-are-available-from-which-sources","title":"How can I find out which candidate versions of which packages are available from which sources?","text":"<p>Simply</p> <pre><code>apt-cache policy {{ PACKAGE_NAME }}\n</code></pre>"},{"location":"Terminal/basics/#how-to-grabstream-stdinstdout-to-a-command","title":"How to grab/stream stdin/stdout to a command?","text":"<p>Simply use the \"-\" to indicate where to stream the output of the previous command.</p> <pre><code>cp -\n</code></pre>"},{"location":"Terminal/basics/#create-an-ssh-key","title":"Create an SSH key","text":"<p>Then create your ssh key</p> <pre><code>ssh-keygen -o -a 100 -t ed25519 -f ~/.ssh/{{ KEY_NAME }} -N \"\"\nssh-copy-id -o PreferredAuthentications=password -i ~/.ssh/{{ KEY_NAME }}.pub {{ USER }}@{{ HOST_IP }}\nrm ~/.ssh/{{ KEY_NAME }}.pub\necho \"Host {{ HOST_NAME }}\n    Hostname SERVER\n    Port 22\n    user {{ USER_NAME }}\n    IdentityFile ~/.ssh/{{ KEY_NAME }}\n\" &gt;&gt; ~/.ssh/config\n</code></pre> <p>Sources:</p> <ul> <li>https://medium.com/risan/upgrade-your-ssh-key-to-ed25519-c6e8d60d3c54</li> </ul>"},{"location":"Terminal/nice2know/","title":"Terminal Nice2Know","text":""},{"location":"Terminal/nice2know/#how-do-i-open-an-editor-to-input-multiline-commands","title":"How do I open an editor to input multiline commands?","text":"<p>use Ctrl+X and Ctrl+E</p> <p>Sources:</p> <ul> <li>https://www.tecmint.com/linux-command-line-bash-shortcut-keys/</li> </ul>"},{"location":"Terminal/nice2know/#how-to-clear-bash-history-completely","title":"How to clear bash history completely?","text":"<p>However,</p> <p>One annoying side-effect is that the history entries has a copy in the memory and it will flush back to the file when you log out.</p> <p>To workaround this, use the following command (worked for me):</p> <pre><code>cat /dev/null &gt; ~/.bash_history &amp;&amp; history -c &amp;&amp; exit\n</code></pre> <p>Sources:</p> <ul> <li>https://askubuntu.com/questions/191999/how-to-clear-bash-history-completely</li> </ul>"},{"location":"Terminal/snippets/","title":"Terminal Snippets","text":""},{"location":"Terminal/snippets/#how-do-i-create-numbered-folders-with-a-loop","title":"How do I create numbered folders with a loop?","text":"<pre><code>for i in $(seq 1 13);\ndo mkdir session_$i; done\n</code></pre>"},{"location":"Terminal/snippets/#my-file-names-are-too-long-how-can-i-fix-that","title":"My file names are too long, how can I fix that?","text":"<pre><code>find . -type f -exec rename 's/(.*\\/)(.{20}).*(\\.pdf)$/$1$2$3/' {} \\;\n</code></pre>"},{"location":"Terminal/snippets/#my-filenames-have-special-character-how-to-fix-that","title":"My filenames have special character, how to fix that?","text":"<pre><code>for file in ./*; do cd \"$file\"; rename 's/\\W/_/g' *; rename 's/_+/_/g' *; cd {{ PATH_TO_FILES }}; done\nfind . -type f -exec rename 's/_mp3/.mp3/' {} \\;\n</code></pre> <p>Sources:</p> <ul> <li>https://unix.stackexchange.com/questions/216659/how-to-rename-all-files-with-special-characters-and-spaces-in-a-directory</li> </ul>"},{"location":"Terminal/snippets/#how-many-files-are-in-a-folder","title":"How many files are in a folder?","text":"<pre><code>find . -type f | wc -l\n</code></pre> <p>Sources:</p> <ul> <li>https://superuser.com/questions/198817/recursively-count-all-the-files-in-a-directory</li> </ul>"},{"location":"Terminal/snippets/#what-do-i-do-if-i-accidentially-deleted-etcfstab","title":"What do I do if I accidentially deleted /etc/fstab?","text":"<pre><code>sudo blkid\n</code></pre> <p>choose mapping and :</p> <pre><code>sudo mount -t ext4 -o rw,remount /dev/sdb2 /\n</code></pre> <p>Sources:</p> <ul> <li>https://askubuntu.com/a/435966</li> </ul>"},{"location":"Terminal/snippets/#how-do-i-access-the-error-logs-of-a-particular-service","title":"How do I access the error logs of a particular service?","text":"<p>like:</p> <pre><code>journalctl -u {{ NAME_OF_SERVICE }}\n</code></pre> <p>Sources:</p> <ul> <li>https://www.loggly.com/ultimate-guide/using-journalctl/</li> </ul>"},{"location":"Terminal/snippets/#how-do-i-scan-a-serverip-for-open-ports","title":"How do I scan a Server/IP for open ports?","text":"<pre><code>sudo nmap -sT {{ SERVER_IP }}\n</code></pre> <p>Sources:</p> <ul> <li>https://linuxize.com/post/check-open-ports-linux/#check-open-ports-with-nmap</li> </ul>"},{"location":"Terminal/snippets/#how-do-i-force-ssh-to-use-password-authentication","title":"How do I force ssh to use password authentication?","text":"<pre><code>ssh -o PreferredAuthentications=password\n</code></pre> <p>Sources:</p> <ul> <li>https://unix.stackexchange.com/questions/15138/how-to-force-ssh-client-to-use-only-password-auth</li> </ul>"},{"location":"Terminal/snippets/#how-to-watch-the-output-of-a-command-over-time","title":"How to watch the output of a command over time?","text":"<pre><code>watch -n 1 \"kubectl top pod --namespace {{ NAMESPACE_NAME }} {{ POD_NAME }}\"\n</code></pre> <p>Sources:</p> <ul> <li>https://github.com/kubernetes/kubernetes/issues/52963#issuecomment-331781491</li> </ul>"},{"location":"Ubuntu/configuration/","title":"Ubuntu Configuration","text":""},{"location":"Ubuntu/configuration/#how-do-i-set-the-timezone","title":"How do I set the timezone?","text":"<pre><code>timedatectl\ntimedatectl set-timezone Europe/Berlin\n</code></pre> <p>Sources:</p> <ul> <li>https://linuxize.com/post/how-to-set-or-change-timezone-on-ubuntu-18-04</li> </ul>"},{"location":"Ubuntu/configuration/#how-can-i-permanently-disable-wifi","title":"How can I permanently disable wifi?","text":"<p>The best way is via the package rfkill</p> <pre><code>aptitude install -y rfkill\n</code></pre> <p>It works like a switch and disables wifi on boot</p> <pre><code>rfkill block wifi\n</code></pre>"},{"location":"Ubuntu/configuration/#how-to-deactivate-bluetooth-at-start","title":"How to deactivate bluetooth at start?","text":"<p>We enter a softblock for the corresponding function in the file rc.local:</p> <pre><code>vi /etc/rc.local\n</code></pre> <p>Add following line</p> <pre><code>rfkill block bluetooth\n</code></pre> <p>Rfkill is a command to query or change the status of switches in the system. If there is no file then:</p> <pre><code>sudo install -b -m 755 /dev/stdin /etc/rc.local &lt; EOF\n  #!/bin/sh\nrfkill block bluetooth\n  exit 0\nEOF\n</code></pre> <p>Sources:</p> <ul> <li>https://itsfoss.com/turn-off-bluetooth-by-default-in-ubuntu-14-04/</li> <li>https://askubuntu.com/questions/67758/how-can-i-deactivate-bluetooth-on-system-startup</li> </ul>"},{"location":"Ubuntu/configuration/#ssh","title":"SSH","text":""},{"location":"Ubuntu/configuration/#config","title":"Config","text":"<p>Neuerdings verwende ich keepassxc SSH-Agent f\u00fcr die Verwaltung. Damit das funktioniert muss(!) Keepass aus dem ppa installiert werden. Au\u00dferdem muss unter \"Startup Applications\" Der Gnome Keyring SSH - Agent abgestellt werden. Sonst sind die keys nicht da.</p> <p>nicht vergessen die Hosts einmal mittels \"ssh key\" zu aktivieren bzw. in known_host zu hinterlegen, sonst funktionieren die Scripts sp\u00e4ter nicht!</p> <pre><code>Host raspi\n  HostName {{ HOST_IP }}\n  port 22\n  user {{ USER }}\n  IdentityFile {{ SSH_KEY_PATH }}\n</code></pre>"},{"location":"Ubuntu/configuration/#network","title":"Network","text":""},{"location":"Ubuntu/configuration/#how-do-i-connect-to-wlan-on-ubuntu","title":"How do I connect to WLAN on Ubuntu?","text":"<p>Do</p> <pre><code>vi /etc/netplan/50-cloud-init.yaml\n</code></pre> <p>insert:</p> <pre><code>wifis:\nwlan0:\ndhcp4: true\noptional: true\naccess-points:\n\"{{ SSID_NAME }}\":\npassword: \"{{ WIFI_PASSWORD }}\"\n</code></pre> <p>Generate the netplan below</p> <pre><code>netplan generate\n</code></pre> <p>and apply</p> <pre><code>netplan apply\n</code></pre> <p>If errors occur here, a missing wpa supplicant service may be the problem</p> <pre><code>systemctl start wpa_supplicant\n</code></pre> <p>then apply again and if that does not work:</p> <pre><code>systemctl reboot\n</code></pre> <p>Sources:</p> <ul> <li>https://itsfoss.com/connect-wifi-terminal-ubuntu/</li> </ul>"},{"location":"Ubuntu/configuration/#how-do-i-set-a-static-ip","title":"How do I set a static IP?","text":"<p>Set Static IP via netplan:</p> <pre><code>vi /etc/netplan/01-netcfg.yaml\n</code></pre> <p>insert:</p> <pre><code>network:\nversion: 2\nrenderer: networkd\nethernets:\neth0:\ndhcp4: no\naddresses:\n- {{ FIXED_IP }}/24\ngateway4: {{ GATEWAY_IP_ADDRESS}}\nnameservers:\naddresses: [{{ DNS_IP_ADDRESS }}]\n</code></pre> <p>Generate the netplan below</p> <pre><code>netplan generate\n</code></pre> <p>and apply</p> <pre><code>netplan apply\n</code></pre> <p>Sources:</p> <ul> <li>https://www.techrepublic.com/article/how-to-configure-a-static-ip-address-in-ubuntu-server-18-04/</li> <li>https://www.snel.com/support/how-to-configure-ipv6-with-netplan-on-ubuntu-18-04/</li> <li>https://help.ubuntu.com/lts/serverguide/network-configuration.html#ip-addressing</li> </ul>"},{"location":"Ubuntu/configuration/#user-control","title":"User control","text":""},{"location":"Ubuntu/configuration/#create-a-user-and-give-it-sudo","title":"Create a user and give it sudo","text":"<p>Always create non root user and change password of root</p> <pre><code>passwd root\nadduser {{ USER }}\n</code></pre> <p>Add the new user to sudoer group</p> <pre><code>usermod -aG sudo {{ USER }}\n</code></pre>"},{"location":"Ubuntu/configuration/#set-up-passwordless-sudo","title":"set up passwordless sudo","text":"<p>Activate passwordless sudo</p> <pre><code>echo \"{{ USER }} ALL=(ALL:ALL) NOPASSWD:ALL\" &gt;&gt; /etc/sudoers\n</code></pre>"},{"location":"Ubuntu/configuration/#security","title":"Security","text":""},{"location":"Ubuntu/configuration/#network-hardening","title":"Network hardening","text":"<p>Use a firewall like ufw or firewalld. Turn in on and block all ports.</p>"},{"location":"Ubuntu/configuration/#ssh-hardnening","title":"SSH hardnening","text":"<p>Once you have authenticated the new key, deactivate non key authentication(use extended Regex -E option):</p> <pre><code>sed -i -E -e \"s:#?PasswordAuthentication.*:PasswordAuthentication no:\" -e \"s:#?ChallengeResponseAuthentication.*:ChallengeResponseAuthentication no:\" /etc/ssh/sshd_config\n</code></pre> <p>Restart Service:</p> <pre><code>systemctl restart sshd\n</code></pre>"},{"location":"Ubuntu/configuration/#backup","title":"Backup","text":""},{"location":"Ubuntu/configuration/#how-to-use-rsync","title":"How to use Rsync","text":"<p>rsync has many different options. A useful one is -h (human readable)</p> <pre><code>rsync -h\n</code></pre> <p>This streamlines the file paths so that only the currently transferred file is included and not the whole path. It also converts the amount of data transferred instead of outputting bytes.</p> <p>Important learning on my side. The z option makes no sense in most cases without rceiving rsync. Because there is a rsync protocol in HIdrive: Probably useful, but not at all for e.g. local or on USB.</p> <pre><code>rsync -z\n</code></pre> <p>if granular logging with timestamps is desired, the following notation can be chosen.</p> <pre><code>rsync --out-format=\"%t %f %b\"\n</code></pre> <p>the exclude option is always relative to the source path (don't always choose the a option, often t(timestamps preserve) r(recursive) is enough). Preserving permissions can also quickly lead to errors).</p> <pre><code>rsync --delete -azvhr --exclude '{{ FOLDER_TO_EXCLUDE }}' {{ SOURCE_FOLDER }} {{ SOURCE_FOLDER_2 }} {{ REMOTE_NAME }}:{{ SINK_FOLDER }}\n</code></pre> <p>Very useful is also the stats option together with h</p> <pre><code>rsync --delete -azvhr --stats --exclude '{{ FOLDER_TO_EXCLUDE }}' {{ SOURCE_FOLDER }} {{ SOURCE_FOLDER_2 }} {{ REMOTE_NAME }}:{{ SINK_FOLDER }}\n</code></pre> <p>Cron can help with scheduling.</p>"},{"location":"Ubuntu/configuration/#use-borgbackup","title":"Use borgbackup","text":"<p>For repairing borgbackup repository in case of power loss:</p> <pre><code>sudo borg -p -v check --repair --bypass-lock {{ BORGBACKUP_FOLDER }}\n</code></pre> <p>to remove a lock</p> <pre><code>borg break-lock {{ BORGBACKUP_FOLDER }}\n</code></pre> <p>Sources:</p> <ul> <li>https://borgbackup.readthedocs.io/en/stable/usage/check.html</li> <li>https://borgbackup.readthedocs.io/en/stable/usage/lock.html</li> </ul>"},{"location":"Ubuntu/configuration/#cron","title":"Cron","text":"<pre><code>crontab -e\n</code></pre> <p>Sources:</p> <ul> <li>https://askubuntu.com/questions/173924/how-to-run-a-cron-job-using-the-sudo-command</li> <li>https://www.linode.com/docs/tools-reference/tools/schedule-tasks-with-cron/</li> <li>https://crontab.guru</li> </ul>"},{"location":"Ubuntu/configuration/#31-how-to-log-cronjob-output","title":"3.1. How to log Cronjob output?","text":"<p>How to write output to a file:</p> <pre><code>00 10 ** * rsync --delete -azvr {{ SOURCE_FOLDER }} {{ SOURCE_FOLDER_2 }} {{ REMOTE_NAME }}:{{ SINK_FOLDER }} &gt;&gt; {{ LOG_PATH }} 2&gt;&amp;1\n</code></pre> <p>use brackets for multiple commands</p> <pre><code>(rsync -azv test test &amp;&amp; rsync -azvr test test) &gt;&gt; {{ LOG_PATH }} 2&gt;&amp;1\n</code></pre> <p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/4811738/how-to-log-cron-jobs</li> <li>https://stackoverflow.com/questions/818255/in-the-shell-what-does-21-mean</li> <li>https://unix.stackexchange.com/questions/52330/how-to-redirect-output-to-a-file-from-within-cron</li> <li>https://askubuntu.com/questions/936710/write-to-file-output-of-two-commands-running-together-in-one-terminal</li> </ul>"},{"location":"Ubuntu/configuration/#how-to-log-cron-to-postfixssmtp-respectively-email-address","title":"How to log Cron to Postfix/SSMTP respectively email address?","text":"<p>See msmtp instructions</p>"},{"location":"Ubuntu/configuration/#how-do-i-use-locks-and-avoid-duplicates-of-the-same-cron-job","title":"How do I use locks and avoid duplicates of the same cron job??","text":"<pre><code>* * * * * flock -n {{ PATH_TO_LOCKFILE }} {{ COMMAND }}\n</code></pre> <p>or if shell chains are to be used</p> <pre><code>* * * * * flock -n {{ PATH_TO_LOCKFILE }} -c {{ COMMAND }} &amp;&amp; {{ COMMAND }}\n</code></pre> <p>Sources:</p> <ul> <li>https://serverfault.com/questions/82857/prevent-duplicate-cron-jobs-running</li> </ul>"},{"location":"Ubuntu/configuration/#firmware-kernel-and-grub","title":"Firmware, Kernel and GRUB","text":""},{"location":"Ubuntu/configuration/#how-does-the-grub-menu-work","title":"How does the GRUB menu work?","text":"<p>By default, GRUB will show the menu if there is a second operating system installed. If only Ubuntu is installed, then GRUB will generally load Ubuntu without showing the menu(unless u press shift/esc etc.). To reconfigure GRUB to always show a menu:</p> <pre><code>vi /etc/default/grub\n</code></pre> <pre><code>Set GRUB_HIDDEN_TIMEOUT= # (no value after the = sign).\nSet GRUB_TIMEOUT=n # to show the menu for n seconds.\n</code></pre> <pre><code>update-grub </code></pre> <p>to regenerate /boot/grub/grub.cfg based on the /etc/default/grub settings.</p> <p>Sources:</p> <ul> <li>https://askubuntu.com/questions/16042/how-to-get-to-the-grub-menu-at-boot-time</li> </ul>"},{"location":"Ubuntu/configuration/#how-do-i-set-an-old-kernel-as-default-in-grub","title":"How do I set an old kernel as default in GRUB?","text":"<p>The best solution for me was to set (in /etc/default/grub):</p> <pre><code>GRUB_DEFAULT=saved\nGRUB_SAVEDEFAULT=true\n</code></pre> <pre><code>sudo update-grub\n</code></pre> <p>Sources:</p> <ul> <li>https://www.gnu.org/software/grub/manual/grub/grub.html#Configuration</li> <li>https://askubuntu.com/a/1000735</li> </ul>"},{"location":"Ubuntu/configuration/#how-do-i-change-the-default-the-location-of-user-folders","title":"How do I change the default the location of user folders ?","text":"<pre><code>vi ~/.config/user-dirs.dirs\n</code></pre> <p>Each row is a user folder definition (music, video...), edit as you want. For example, I did not want the videos folder in home, but in a separate disk, and changed the XDG_VIDEOS_DIR parameter this way</p> <p>Bear in mind in particular that, if at startup it is found that the XDG_DOCUMENTS_DIR path actually doesn't lead to a valid directory, the setting for XDG_DOCUMENTS_DIR will be overwritten in user-dir.dirs, replacing it, in principle, with $HOME/Documents</p> <p>restart nautilus! in simpler solution could be to replace the document folder with a symlink.</p> <pre><code>ln -s ~/target/folder ~/Link_name </code></pre> <p>last for creation in current directory the s stands for symbolic  </p> <p>Sources:</p> <ul> <li>https://askubuntu.com/questions/67044/change-default-user-folders-path</li> <li>https://askubuntu.com/questions/56339/how-to-create-a-soft-or-symbolic-link</li> </ul>"},{"location":"Ubuntu/configuration/#how-do-i-perform-a-firmware-update-of-the-wifi-and-how-do-i-restart-the-driver","title":"How do I perform a firmware update of the WiFi and how do I restart the driver?","text":"<p>check Firmware under:</p> <pre><code>sudo ethtool -i {{ WIFI_NAME }}\n</code></pre> <p>Easily restart Wifi without restart computer</p> <pre><code>sudo lshw -C network\nsudo modprobe -r iwlwifi &amp;&amp; sudo modprobe iwlwifi\n</code></pre> <p>Sources:</p> <ul> <li>https://askubuntu.com/questions/26054/how-to-restart-wifi-interface-without-rebooting-it-drops-connection</li> <li>https://wireless.wiki.kernel.org/en/users/drivers/ath10k/debug#firmware_version</li> </ul>"},{"location":"Ubuntu/configuration/#how-to-deal-with-packages-have-been-kept-back-in-apt","title":"How to deal with packages have been kept back in apt?","text":"<p>Sources:</p> <ul> <li>https://askubuntu.com/questions/601/the-following-packages-have-been-kept-back-why-and-how-do-i-solve-it</li> </ul>"},{"location":"Ubuntu/snippets/","title":"Ubuntu Snippets","text":""},{"location":"Ubuntu/snippets/#how-do-i-remove-desktop-shortcuts-from-lets-say-appimages","title":"How do I remove desktop shortcuts from lets say appimages?","text":"<pre><code>ls ~/.local/share/applications/\n</code></pre> <p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/43680226/how-can-i-uninstall-an-appimage</li> </ul>"},{"location":"Ubuntu/snippets/#test-desktop-files","title":"Test .desktop files","text":"<p>just run:</p> <pre><code>gtk-launch {{ PATH_TO_DESKTOP_FILE }}\n</code></pre> <p>Sources:</p> <ul> <li>https://askubuntu.com/questions/5172/running-a-desktop-file-in-the-terminal</li> </ul>"},{"location":"Ubuntu/snippets/#how-to-wait-for-mount-before-service-is-started","title":"How to wait for mount before service is started?","text":"<p>Use</p> <pre><code>ConditionPathIsMountPoint={{ MOUNTPOINT_PATH }}\n</code></pre> <p>To let a a service wait for a folder plus checking if it is a mountpoint.</p> <p>Sources:</p> <ul> <li>https://unix.stackexchange.com/questions/281650/systemd-unit-requiresmountsfor-vs-conditionpathisdirectory</li> </ul>"},{"location":"Ubuntu/snippets/#how-do-i-set-up-and-flush-the-dns","title":"How do I set up and flush the DNS?","text":"<pre><code>sudo systemd-resolve --flush-caches\nsudo systemd-resolve --statistics\nresolvectl flush-caches </code></pre> <p>Sources:</p> <ul> <li>https://askubuntu.com/questions/906476/how-can-i-flush-the-dns-on-ubuntu-17-04</li> <li>https://askubuntu.com/questions/1404586/how-to-clear-dns-cache-in-22-04</li> </ul>"},{"location":"Ubuntu/snippets/#how-to-turn-leds-off-in-raspberry-pi-or-change-hadware-functions","title":"How to turn LEDs off in raspberry pi or change hadware functions","text":"<p>You can use the /boot/firmware/config.txt for that. It will allow you to alter the so called device tree which is a manual for the kernel on what to activate how to treat different parts of the hardware.</p> <p>Example how to turn off wifi and bluetooth:</p> <pre><code>[all]\ndtoverlay=disable-bt\ndtoverlay=disable-wifi\n</code></pre> <p>or turn off lan and activity leds:</p> <pre><code>[all]\ndtparam=eth_led0=4\ndtparam=eth_led1=4\ndtparam=act_led_trigger=none\n</code></pre> <p>Sources:</p> <ul> <li>https://github.com/raspberrypi/firmware/blob/master/boot/overlays/README</li> <li>https://github.com/seamusdemora/PiFormulae/blob/master/LEDControlForRPi.md</li> <li>https://stackoverflow.com/questions/19863723/turn-off-leds-of-raspberry-pi</li> <li>https://raspberrypi.stackexchange.com/questions/70593/turning-off-leds-on-raspberry-pi-3</li> </ul>"},{"location":"Ubuntu/troubleshooting/","title":"Ubuntu Troubleshooting","text":""},{"location":"Ubuntu/troubleshooting/#apt-get-packages-have-been-kept-back","title":"Apt-get Packages have been kept back.","text":"<p>Sources:</p> <pre><code>sudo apt-get --with-new-pkgs upgrade\n</code></pre> <ul> <li>https://askubuntu.com/questions/601/the-following-packages-have-been-kept-back-why-and-how-do-i-solve-it</li> </ul>"},{"location":"Ubuntu/troubleshooting/#raspi-ubuntu-server-usb-boot","title":"Raspi ubuntu server - usb boot","text":"<p>Don't use Ubuntu server &gt; 21.04 for usb boot</p> <p>Sources:</p> <ul> <li>https://medium.com/xster-tech/move-your-existing-raspberry-pi-4-ubuntu-install-from-sd-card-to-usb-ssd-52e99723f07b</li> <li>https://www.raspberrypi.org/software/</li> <li>https://ubuntu.com/tutorials/how-to-install-ubuntu-on-your-raspberry-pi#2-prepare-the-sd-card</li> </ul>"},{"location":"Ubuntu/troubleshooting/#how-to-fix-the-locale-issue","title":"How to fix the locale issue","text":"<p>First run locale to list what locales currently defined for the current user account:</p> <pre><code>locale\n</code></pre> <p>Then generate the missing locale and reconfigure locales to take notice:</p> <p>important select with spacebar in the generate locale probably the problem is that it sets the locale to de but there is none</p> <pre><code>sudo locale-gen 'en_US.UTF-8'\nexport LANGUAGE=en_US.UTF-8\nexport LC_ALL=en_US.UTF-8\nexport LANG=en_US.UTF-8\n</code></pre> <p>or try to generate them, i.e. de_DE.UTF-8</p> <pre><code>sudo dpkg-reconfigure locales\n</code></pre> <p>Sources:</p> <ul> <li>http://www.iasptk.com/ubuntu-fix-locale-issue/</li> </ul>"},{"location":"Ubuntu/troubleshooting/#inotify-limit-exceeded-wie-finde-ich-raus-wer-die-aufbraucht-und-erhohe-das-limit","title":"Inotify limit exceeded - wie finde ich raus, wer die aufbraucht und erh\u00f6he das limit?","text":"<p>In letzter Zeit gab es \u00f6fters das Problem, das die Inotify Limits exceeded wurden. Inotify ist ein Dienst von Linux, der die \u00dcberwachung von Dateien auf der Festplatte anbietet und das Programm benachrichtigt, wenn eine \u00c4nderung vorliegt.</p> <p>Dieses Skript erlaubt es alle Verbraucher von intotify anzuzeigen</p> <pre><code>#!/bin/sh\nlines=$(\nfind /proc/*/fd \\\n-lname anon_inode:inotify \\\n-printf '%hinfo/%f\\n' 2&gt;/dev/null \\\n\\\n| xargs grep -c '^inotify'  \\\n| sort -n -t: -k2 -r \\\n)\nprintf \"\\n%10s\\n\" \"INOTIFY\"\nprintf \"%10s\\n\" \"WATCHER\"\nprintf \"%10s  %5s     %s\\n\" \" COUNT \" \"PID\" \"CMD\"\nprintf -- \"----------------------------------------\\n\"\nfor line in $lines; do\nwatcher_count=$(echo $line | sed -e 's/.*://')\npid=$(echo $line | sed -e 's/\\/proc\\/\\([0-9]*\\)\\/.*/\\1/')\ncmdline=$(ps --columns 120 -o command -h -p $pid) printf \"%8d  %7d  %s\\n\" \"$watcher_count\" \"$pid\" \"$cmdline\"\ndone\n</code></pre> <p>Sources:</p> <ul> <li>https://github.com/fatso83/dotfiles/blob/master/utils/scripts/inotify-consumers</li> <li>https://unix.stackexchange.com/questions/498393/how-to-get-the-number-of-inotify-watches-in-use</li> <li>https://stackoverflow.com/questions/13758877/how-do-i-find-out-what-inotify-watches-have-been-registered</li> </ul>"},{"location":"Ubuntu/troubleshooting/#how-to-fix-dns-resolver-issues-ubuntu-2004","title":"How to fix DNS resolver issues? (Ubuntu 20.04)","text":"<p>I had a lot of problems with Ubuntu not resolving websites and packages. The issue seems to be that it uses the local domain (fritz.box) for some addresses which leads to NXDOMAIN. No clue why.</p> <p>It seem to suffice to</p> <pre><code>vi /etc/systemd/resolved.conf\n</code></pre> <p>change line</p> <pre><code>#DNSStubListener=yes\n</code></pre> <p>to</p> <pre><code>&gt; DNSStubListener=no\n</code></pre> <p>Restart service</p> <pre><code>systemctl enable systemd-resolved.service &amp;&amp; systemctl start systemd-resolved.service\n</code></pre> <p>Currently trying to disable systemd-resolver all together. So far works</p> <pre><code>systemctl disable systemd-resolved.service &amp;&amp; systemctl stop systemd-resolved.service\nvi /etc/NetworkManager/NetworkManager.conf\n</code></pre> <p>add new line in</p> <pre><code>[main]\ndns=default\n</code></pre> <pre><code>rm /etc/resolv.conf\nsystemctl restart network-manager\n</code></pre> <p>Recreate with:</p> <pre><code>vi /etc/NetworkManager/NetworkManager.conf\nsystemctl enable systemd-resolved.service &amp;&amp; systemctl start systemd-resolved.service\nrm /etc/resolv.conf\nsudo ln -s /run/resolvconf/resolv.conf /etc/resolv.conf\nsystemctl restart network-manager\n</code></pre> <p>Sources:</p> <ul> <li>https://gist.github.com/zoilomora/f7d264cefbb589f3f1b1fc2cea2c844c</li> <li>https://askubuntu.com/a/1195074</li> </ul>"},{"location":"Ubuntu/troubleshooting/#how-to-fix-missing-bluetooth-microphone","title":"How to fix missing bluetooth microphone?","text":"<p>This works</p> <pre><code>pulseaudio --kill &amp;&amp; pulseaudio --start\n</code></pre> <p>Deactivate</p> <pre><code>{{ PATH_TO_MODEM_BINARY }} /phonesim\npulseaudio --kill &amp;&amp; pulseaudio --start\npulseeffects --quit &amp;&amp; pulseeffects &amp;\n</code></pre> <p>Sources:</p> <ul> <li>https://askubuntu.com/questions/952342/cant-change-profile-to-hsp-for-bluetooth-headset?noredirect=1&amp;lq=1</li> <li>https://askubuntu.com/a/1242489</li> <li>https://askubuntu.com/a/1301127</li> <li>https://askubuntu.com/a/1236379</li> </ul>"},{"location":"Ubuntu/troubleshooting/#wie-lose-ich-error-starting-userland-proxy-listen-tcp-000053-bind-address-already-in-use","title":"Wie l\u00f6se ich Error starting userland proxy: listen tcp 0.0.0.0:53: bind: address already in use?","text":"<p>Might happen because of systemd-resolv, see bash on how to check ports.  </p> <p>Sources:</p> <ul> <li>https://www.linuxuprising.com/2020/07/ubuntu-how-to-free-up-port-53-used-by.html</li> </ul>"},{"location":"Ubuntu/troubleshooting/#fixing-the-upower-constantly-showing-notification-about-low-power-devices-ubuntu-2004","title":"Fixing the upower constantly showing notification about low power devices (Ubuntu 20.04)","text":"<p>Sources:</p> <ul> <li>https://wrgms.com/disable-mouse-battery-low-spam-notification/</li> <li>https://askubuntu.com/questions/985963/disable-mouse-battery-low-spam-notification</li> </ul>"},{"location":"Ubuntu/troubleshooting/#find-printer-with-hplip","title":"Find printer with hplip","text":"<p>for finding the printer I had to disable ufw once and enable it again</p> <p>Sources:</p> <ul> <li>https://developers.hp.com/hp-linux-imaging-and-printing/</li> </ul>"},{"location":"Ubuntu/troubleshooting/#cron","title":"Cron","text":""},{"location":"Ubuntu/troubleshooting/#why-my-script-does-not-work-or-works-in-shell-but-not-as-cron","title":"Why my script does not work or works in shell but not as cron?","text":"<p>Possibly the problem could be the environment, apparently cron runs in a minimal environment and that leads to the problems.</p> <p>Solution is to insert the following line in crontab:</p> <pre><code>PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n</code></pre> <p>Alternatively directly in the script:</p> <pre><code>#!/bin/sh\nPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:{{ PATH_TO_SCRIPT }}\n</code></pre> <p>Sources:</p> <ul> <li>https://stackoverflow.com/questions/2229825/where-can-i-set-environment-variables-that-crontab-will-use</li> <li>https://serverfault.com/questions/337631/crontab-execution-doesnt-have-the-same-environment-variables-as-executing-user</li> <li>https://unix.stackexchange.com/questions/27289/how-can-i-run-a-cron-command-with-existing-environmental-variables</li> <li>https://askubuntu.com/questions/117978/script-doesnt-run-via-crontab-but-works-fine-standalone</li> </ul>"},{"location":"Ubuntu/usage/","title":"Ubuntu Usage","text":""},{"location":"Ubuntu/usage/#how-to-mount-things","title":"How to mount things?","text":"<p>Generally we differentiate between devices(/dev/), removable media(/media) and admin mountpoints(/mnt). Admin mountpoints are meant for temporary mounts that should not be visible in programs like Nautilus. /media are used by the system to e.g. auto mount external hard drives. /dev is used for internal devices like CD/DVD or internal hard drives.</p> <p>Sources:</p> <ul> <li>https://help.ubuntu.com/community/Mount</li> </ul>"},{"location":"Ubuntu/usage/#41-davfs","title":"4.1. DAVFS","text":"<p>The generic dav protocol via gfvs is very slow and also leads to problems with Cryptomator as it needs write access, which is stupid with mount via admin.</p> <p>First davfs2 must be installed</p> <pre><code>sudo aptitude install davfs2\n</code></pre> <p>The best way is to use the -o option to mount the drive with the user to be written as owner. This is less of a security risk than allowing the user to mount in general.</p> <p>Is a fuse mount for DAV/WebDAV.</p> <pre><code>sudo mount -t davfs -o uid={{ USER }}  {{ TARGET_IP }}:443 {{ MOUNTPOINT_PATH }}\nsudo mount -t davfs -o uid={{ USER }}  {{ TARGET_URL }}:443 {{ MOUNTPOINT_PATH }}\n</code></pre>"},{"location":"Ubuntu/usage/#42-sshfs","title":"4.2. SSHFS","text":"<p>SSHFS is a fuse mount for SSH. This allows us to mount a filesystem via ssh.</p> <pre><code>sudo sshfs -o allow_other,default_permissions,IdentityFile={{ KEY_PATH }} -p 2222 {{ USER_NAME }}@{{ SERVER_IP_OR_URL }}:/ {{ SINK_FOLDER }}\n</code></pre> <p>Sources:</p> <ul> <li>https://www.digitalocean.com/community/tutorials/how-to-use-sshfs-to-mount-remote-file-systems-over-ssh</li> </ul>"},{"location":"Ubuntu/usage/#allow-users-to-mount","title":"Allow users to mount","text":"<p>Then edit fstab to allow mounting also for a normal user</p> <pre><code>sudo nano /etc/fstab\n</code></pre> <p>insert:</p> <pre><code>http://{{ TARGET_IP }}:443 {{ MOUNTPOINT_PATH }} davfs user,noauto,rw 0 0\n</code></pre> <p>Then add the user to the appropriate group:</p> <pre><code>sudo usermod -a -G davfs2 {{ USER }}\n</code></pre> <p>groups # if not yet current with</p> <pre><code>su -l {{ USER }}\n</code></pre> <p>user can now mount by using:</p> <pre><code>mount {{ MOUNTPOINT_PATH }}\n</code></pre> <p>Sources:</p> <ul> <li>https://github.com/cryptomator/cryptomator/issues/696</li> <li>https://community.cryptomator.org/t/cannot-open-storage-entsperren-fehlgeschlagen/433</li> <li>https://www.systutorials.com/136297/control-filesystem-mounting-on-linux-by-playing-with-etcfstab/#allow-non-root-users-to-mount-and-unmount-filesystems</li> <li>https://askubuntu.com/questions/498492/mounting-a-webdav-share-for-all-users</li> <li>https://blog.sleeplessbeastie.eu/2017/09/04/how-to-mount-webdav-share/</li> <li>https://wiki.ubuntuusers.de/WebDAV/</li> <li>https://www.systutorials.com/docs/linux/man/8-mount.davfs/</li> </ul>"},{"location":"Ubuntu/usage/#why-use-flatpaks","title":"Why use flatpaks?","text":"<p>Flatpaks give an alternative to the classic debs or package distribution systems. A big advantage is that all dependencies are already included in the flatpak. Especially for programs that I only use over and over again like GIMP or QGis a gain.</p> <pre><code>aptitude install flatpak gnome-software-plugin-flatpak\nflatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo\n</code></pre> <p>Sources:</p> <ul> <li>https://flatpak.org/setup/Ubuntu/</li> </ul>"},{"location":"Ubuntu/usage/#how-to-set-up-thunderbolt-devies","title":"How to set up thunderbolt devies","text":"<pre><code>boltctl list\nboltctl forget {{ MYDEVICEID }}\nboltctl enroll --policy auto {{ MYDEVICEID }}\n</code></pre> <p>Sources:</p> <ul> <li>https://christian.kellner.me/2019/02/11/thunderbolt-preboot-access-control-list-support-in-bolt/</li> <li>https://blog.karssen.org/2021/01/05/using-the-lenovo-thunderbolt-3-essential-dock-with-linux/</li> </ul>"},{"location":"Ubuntu/usage/#wie-verwende-ich-systemd-units-richtig","title":"Wie verwende ich systemd units richtig?","text":"<p>Sources:</p> <ul> <li>https://www.digitalocean.com/community/tutorials/understanding-systemd-units-and-unit-files</li> </ul>"},{"location":"Ubuntu/usage/#securely-erase-ssds","title":"Securely erase ssds","text":"<pre><code>sudo hdparm -I /dev/sdX | grep -i erase\n</code></pre> <p>Soures:</p> <ul> <li>https://askubuntu.com/questions/794612/how-to-securely-wipe-files-from-ssd-drive#795756</li> <li>https://www.thomas-krenn.com/en/wiki/Perform_a_SSD_Secure_Erase</li> <li>https://9to5tutorial.com/secure-erase-ssd-in-ubuntu</li> </ul>"}]}